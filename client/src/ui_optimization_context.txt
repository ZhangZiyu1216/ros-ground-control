=== 1. é¡¹ç›®ç›®å½•ç»“æ„ (ä»…åŒ…å«UIç›¸å…³) ===
Project Structure (Vue Context Only):
.
  ğŸ“‚ src/
    ğŸ“‚ renderer/
      ğŸ“‚ src/
        ğŸ“‚ components/
          ğŸ“‚ log/
          ğŸ“‚ monitor/
        ğŸ“‚ views/

==================================================

=== 2. æ–‡ä»¶ä»£ç å†…å®¹ (é€»è¾‘å·²éšè—) ===

--- File: src/renderer/src/App.vue ---
<template>
  <!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
  <router-view />
</template>

<style>
/* å…¨å±€æ ·å¼ï¼šç¡®ä¿æ ¹å…ƒç´ å æ»¡è§†å£ */
html,
body,
#app {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden; /* ç¦æ­¢é¡¶å±‚æ»šåŠ¨ */
  font-family: 'consola', sans-serif;
}
</style>


--- File: src/renderer/src/components/ConnectionDialog.vue ---
<template>
  <el-dialog
    v-model="isDialogVisible"
    title="è¿æ¥é…ç½®"
    width="450px"
    :close-on-click-modal="false"
    @close="closeDialog"
  >
    <el-form :model="form" label-position="top">
      <el-form-item label="è¿æ¥æ¨¡å¼">
        <el-radio-group v-model="form.mode">
          <el-radio-button label="local">Localhost</el-radio-button>
          <el-radio-button label="remote">è¿œç¨‹ (Agent)</el-radio-button>
        </el-radio-group>
      </el-form-item>

      <!-- ä»…åœ¨ Remote æ¨¡å¼ä¸‹æ˜¾ç¤º -->
      <div v-if="form.mode === 'remote'">
        <el-form-item>
          <template #label>
            <div class="host-label-row">
              <span class="label-text">æœºå™¨äºº IP åœ°å€</span>
              <!-- å¤ç”¨åŸæœ‰çš„æ¢æµ‹ UI -->
              <div class="scan-status">
                <span v-if="discoveredDevices.length > 0" class="status-text success">
                  <el-icon><Connection /></el-icon>
                  å·²æ¢æµ‹åˆ° {{ discoveredDevices.length }} å°
                </span>
                <span v-else class="status-text loading">
                  <el-icon class="is-loading"><Loading /></el-icon>
                  æ­£åœ¨æ¢æµ‹ mDNS...
                </span>
              </div>
            </div>
          </template>

          <!-- Autocomplete é€»è¾‘é€‚é… -->
          <el-autocomplete
            ref="hostAutocompleteRef"
            v-model="form.ip"
            :fetch-suggestions="querySearch"
            placeholder="e.g., 192.168.1.100"
            style="width: 100%"
            trigger-on-focus
            clearable
            @select="handleSelect"
          >
            <template #default="{ item }">
              <div class="device-item">
                <!-- æ˜¾ç¤º Hostname å’Œ IP -->
                <span class="device-hostname">{{ item.hostname }}</span>
                <span class="device-ip">{{ item.ip }}</span>
              </div>
            </template>
          </el-autocomplete>
        </el-form-item>

        <!-- æ–°å¢ï¼šåç§°å¤‡æ³¨ -->
        <el-form-item label="åç§° (å¯é€‰)">
          <el-input v-model="form.name" placeholder="ä¾‹å¦‚: Turtlebot 4"></el-input>
        </el-form-item>
      </div>

      <!-- Local æ¨¡å¼æç¤º -->
      <div v-if="form.mode === 'local'" style="color: #909399; font-size: 13px">
        å°†è¿æ¥åˆ°è¿è¡Œåœ¨æœ¬æœºçš„ Agent (http://127.0.0.1:8080)
      </div>
    </el-form>
    <template #footer>
      <span class="dialog-footer">
        <el-button @click="closeDialog">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="applyAndClose">ç¡®å®š</el-button>
      </span>
    </template>
  </el-dialog>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.device-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}
.device-hostname {
  font-weight: bold;
  color: #333;
}
.device-ip {
  font-size: 12px;
  color: #999;
}
.scan-hint {
  margin-top: 5px;
  font-size: 12px;
  color: #909399;
  display: flex;
  align-items: center;
  gap: 5px;
}
:deep(.el-form-item--label-top .el-form-item__label) {
  width: 100%;
}
.host-label-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%; /* ç¡®ä¿å æ»¡æ•´è¡Œå®½åº¦ */
}

.scan-status {
  font-weight: normal;
  font-size: 12px;
}

.status-text {
  display: flex;
  align-items: center;
  gap: 4px;
}

.status-text.loading {
  color: #909399; /* ç°è‰² */
}

.status-text.success {
  color: #67c23a; /* ç»¿è‰²ï¼Œæç¤ºç”¨æˆ·å·²å‘ç°è®¾å¤‡ */
}

/* ä¿æŒåŸæœ‰çš„ device-item æ ·å¼ */
.device-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}
.device-hostname {
  font-weight: bold;
  color: #333;
}
.device-ip {
  font-size: 12px;
  color: #999;
}
</style>


--- File: src/renderer/src/components/FileBrowser.vue ---
<template>
  <div
    v-loading="isInitializing"
    class="file-browser"
    element-loading-background="rgba(255, 255, 255, 0.8)"
  >
    <!-- 1. å·¦ä¾§å¯¼èˆªæ  -->
    <div class="sidebar">
      <el-menu :default-active="currentPath" @select="handleMenuSelect">
        <el-menu-item-group title="å¸¸ç”¨ä½ç½®">
          <el-menu-item v-for="place in sidebarItems.places" :key="place.path" :index="place.path">
            <el-icon><component :is="iconMap[place.icon] || Folder" /></el-icon>
            <span>{{ place.name }}</span>
          </el-menu-item>
        </el-menu-item-group>
        <el-menu-item-group title="ä¹¦ç­¾">
          <el-menu-item
            v-for="bookmark in sidebarItems.bookmarks"
            :key="bookmark.path"
            :index="bookmark.path"
          >
            <el-icon><component :is="iconMap[bookmark.icon] || Star" /></el-icon>
            <span>{{ bookmark.name }}</span>
          </el-menu-item>
        </el-menu-item-group>
      </el-menu>
    </div>

    <!-- 2. å³ä¾§ä¸»å†…å®¹åŒº -->
    <div class="main-content" @dragenter.prevent.stop="onDragEnter" @dragover.prevent.stop>
      <!-- 2.1 é¡¶éƒ¨å·¥å…·æ  -->
      <div class="header-toolbar">
        <div class="left-controls">
          <el-button-group class="history-nav">
            <el-button :icon="ArrowLeft" :disabled="!canGoBack" @click="goBack" />
            <el-button :icon="ArrowRight" :disabled="!canGoForward" @click="goForward" />
            <el-button :icon="Top" :disabled="isRoot" @click="goUp" />
          </el-button-group>
          <div
            ref="breadcrumbScrollRef"
            class="breadcrumb-wrapper"
            @wheel.prevent="onBreadcrumbWheel"
          >
            <el-breadcrumb :separator-icon="ArrowRight" class="breadcrumb-nav">
              <el-breadcrumb-item
                v-for="item in breadcrumbItems"
                :key="item.path"
                class="breadcrumb-item"
                @click="loadDirectory(item.path)"
              >
                {{ item.name }}
              </el-breadcrumb-item>
            </el-breadcrumb>
          </div>
        </div>
        <div class="right-controls">
          <!-- åµŒå…¥å¼ä¸Šä¼ è¿›åº¦æ¡ -->
          <transition name="el-fade-in">
            <div v-if="uploadStatus.uploading" class="inline-upload-panel">
              <el-icon class="is-loading"><Loading /></el-icon>
              <span class="upload-text">
                ä¸Šä¼ ä¸­ {{ uploadStatus.count }}/{{ uploadStatus.total }}:
                {{ uploadStatus.percent }}%
              </span>
              <div class="mini-progress-bar">
                <div class="bar-inner" :style="{ width: uploadStatus.percent + '%' }"></div>
              </div>
            </div>
          </transition>
          <el-tooltip content="æ˜¾ç¤ºéšè—æ–‡ä»¶" placement="bottom">
            <el-button
              circle
              :type="showHiddenFiles ? 'primary' : ''"
              style="margin-right: 12px"
              @click="showHiddenFiles = !showHiddenFiles"
            >
              <el-icon v-if="showHiddenFiles"><View /></el-icon>
              <el-icon v-else><Hide /></el-icon>
            </el-button>
          </el-tooltip>
          <el-button-group>
            <el-button
              :icon="Tickets"
              :type="viewMode === 'list' ? 'primary' : 'default'"
              @click="viewMode = 'list'"
            />
            <el-button
              :icon="Grid"
              :type="viewMode === 'icon' ? 'primary' : 'default'"
              @click="viewMode = 'icon'"
            />
          </el-button-group>
          <template v-if="showClose">
            <el-divider direction="vertical" style="margin: 0 8px" />
            <el-button
              class="close-button"
              circle
              type="danger"
              plain
              :icon="Close"
              title="å…³é—­çª—å£"
              @click="$emit('close')"
            />
          </template>
        </div>
      </div>

      <!-- 2.2 æ–‡ä»¶åˆ—è¡¨ -->
      <div
        v-loading="isLoading"
        class="file-list-container"
        @contextmenu.prevent="onContainerContextMenu"
      >
        <!-- è¡¨æ ¼è§†å›¾ -->
        <el-table
          v-if="viewMode === 'list'"
          ref="fileTableRef"
          :data="filteredFiles"
          height="100%"
          style="width: 100%"
          highlight-current-row
          :row-class-name="tableRowClassName"
          @row-click="onRowClick"
          @row-dblclick="onRowDoubleClick"
          @row-contextmenu="onRowContextMenu"
        >
          <el-table-column width="50" align="center">
            <template #default="scope">
              <el-icon :size="20"><component :is="getFileIcon(scope.row)" /></el-icon>
            </template>
          </el-table-column>
          <!-- åç§°åˆ— -->
          <el-table-column prop="name" label="åç§°" sortable min-width="200">
            <template #default="scope">
              <!-- æ‹–åŠ¨åç§°å¯ä»¥ä¸‹è½½ -->
              <div
                draggable="true"
                style="cursor: grab"
                @dragstart="onDragStart($event, scope.row)"
              >
                <!-- ç¼–è¾‘æ¨¡å¼ -->
                <div
                  v-if="renamingFileName === scope.row.name"
                  class="rename-container"
                  @click.stop
                >
                  <el-input
                    v-model="renameInputValue"
                    size="small"
                    class="rename-input"
                    @blur="finishInlineRename(scope.row)"
                    @keyup.enter="finishInlineRename(scope.row)"
                    @keyup.esc="cancelInlineRename"
                  />
                </div>
                <!-- æ˜¾ç¤ºæ¨¡å¼ -->
                <span v-else>{{ getDisplayName(scope.row) }}</span>
              </div>
            </template>
          </el-table-column>
          <!-- å¤§å°åˆ— -->
          <el-table-column
            prop="size"
            label="å¤§å°"
            width="120"
            align="right"
            sortable
            :sort-by="['isDir', 'size']"
          >
            <template #default="scope">
              <!-- ç›®å½•ä¸æ˜¾ç¤ºå¤§å° -->
              {{ scope.row.isDir ? '-' : formatSize(scope.row.size) }}
            </template>
          </el-table-column>
          <!-- ä¿®æ”¹æ—¥æœŸåˆ— -->
          <el-table-column
            prop="modified"
            label="ä¿®æ”¹æ—¥æœŸ"
            width="180"
            align="right"
            sortable
            :sort-by="['isDir', 'modified']"
          >
            <template #default="scope">
              {{ formatDate(scope.row.modified) }}
            </template>
          </el-table-column>
        </el-table>

        <!-- å›¾æ ‡è§†å›¾ -->
        <div v-if="viewMode === 'icon'" class="icon-view-container">
          <div
            v-for="file in filteredFiles"
            :key="file.name"
            class="icon-item"
            :class="getItemClass(file)"
            :title="`${getDisplayName(file)}\nå¤§å°: ${file.isDir ? '-' : formatSize(file.size)}\nä¿®æ”¹äº: ${formatDate(file.modified)}`"
            draggable="true"
            @click="onRowClick(file)"
            @dblclick="onRowDoubleClick(file)"
            @contextmenu.prevent.stop="onIconContextMenu($event, file)"
            @dragstart="onDragStart($event, file)"
          >
            <el-icon class="item-icon">
              <component :is="getFileIcon(file)" />
            </el-icon>
            <div
              v-if="renamingFileName === file.name"
              class="rename-container icon-rename"
              @click.stop
              @dblclick.stop
            >
              <el-input
                v-model="renameInputValue"
                size="small"
                class="rename-input"
                @blur="finishInlineRename(file)"
                @keyup.enter="finishInlineRename(file)"
                @keyup.esc="cancelInlineRename"
              />
            </div>
            <span v-else class="item-name">{{ getDisplayName(file) }}</span>
          </div>
        </div>

        <el-empty
          v-if="!isLoading && filteredFiles.length === 0 && viewMode === 'list'"
          description="æ–‡ä»¶å¤¹ä¸ºç©º"
        />
      </div>

      <!-- 2.3 åº•éƒ¨æ“ä½œæ  -->
      <div v-if="!hideFooter" class="footer-toolbar">
        <div class="selected-info">
          <!-- [ä¿®æ”¹] æç¤ºæ–‡æ¡ˆ -->
          <template v-if="targetType === 'path'">
            <span
              >å·²é€‰æ‹©:
              {{ selectedFile && selectedFile.isDir ? selectedFile.name : 'å½“å‰ç›®å½•' }}</span
            >
          </template>
          <template v-else>
            <span v-if="selectedFile">å·²é€‰æ‹©: {{ selectedFile.name }}</span>
            <span v-else>æœªé€‰æ‹©æ–‡ä»¶</span>
          </template>
        </div>
        <div>
          <el-button @click="onCancel">å–æ¶ˆ</el-button>
          <el-button type="primary" :disabled="!isSelectionConfirmed" @click="onConfirm"
            >é€‰æ‹©</el-button
          >
        </div>
      </div>

      <!-- é€šç”¨åç§°è¾“å…¥å¼¹çª— (æ–°å»º/é‡å‘½å) -->
      <el-dialog v-model="nameDialogVisible" :title="nameDialogTitle" width="400px" append-to-body>
        <el-input
          ref="nameInputRef"
          v-model="nameDialogValue"
          :placeholder="nameDialogPlaceholder"
          @keyup.enter="handleNameDialogConfirm"
        />
        <template #footer>
          <span class="dialog-footer">
            <el-button @click="nameDialogVisible = false">å–æ¶ˆ</el-button>
            <el-button type="primary" :loading="isProcessing" @click="handleNameDialogConfirm">
              ç¡®å®š
            </el-button>
          </span>
        </template>
      </el-dialog>
      <!-- æ‹–æ‹½ä¸Šä¼ é®ç½©å±‚ -->
      <div
        v-if="isDragOver"
        class="drag-overlay"
        @dragleave.prevent.stop="onDragLeave"
        @drop.prevent.stop="onDrop"
        @dragover.prevent.stop
      >
        <div class="drag-content">
          <el-icon :size="60"><UploadFilled /></el-icon>
          <h3>é‡Šæ”¾æ–‡ä»¶ä»¥ä¸Šä¼ åˆ°å½“å‰ç›®å½•</h3>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.file-browser {
  display: flex;
  flex-direction: row;
  height: 100%;
  width: 100%;
  border-radius: 4px;
  overflow: hidden;
}
/* 1. ä¾§è¾¹æ æ ·å¼ */
.sidebar {
  width: 200px;
  flex-shrink: 0;
  border-right: 1px solid var(--el-border-color);
  background-color: var(--el-bg-color-page);
  overflow-y: auto;
}
:deep(.el-menu) {
  border-right: none; /* ç§»é™¤ ElMenu é»˜è®¤çš„å³è¾¹æ¡† */
}
.el-menu-item-group__title {
  font-size: 12px;
  padding-left: 10px !important;
}
.el-menu-item {
  height: 40px;
}
/* 2. ä¸»å†…å®¹åŒºæ ·å¼ */
.main-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
  min-width: 0;
}
/* 2.1 é¡¶éƒ¨å·¥å…·æ  */
.header-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between; /* å·¦å³å¯¹é½ */
  padding: 8px;
  border-bottom: 1px solid var(--el-border-color);
  flex-shrink: 0;
  gap: 16px;
}
.left-controls {
  display: flex;
  align-items: center;
  flex-shrink: 1; /* <-- æ ¸å¿ƒä¿®å¤ 1: å…è®¸å·¦ä¾§å®¹å™¨æ”¶ç¼© */
  min-width: 0; /* è®© flex item å¯ä»¥æ”¶ç¼© */
}
.breadcrumb-nav {
  margin-left: 12px;
  flex-shrink: 1; /* å…è®¸é¢åŒ…å±‘åœ¨ç©ºé—´ä¸è¶³æ—¶æ”¶ç¼© */
}
.right-controls {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}
/* å¤´éƒ¨å³ä¾§æ§åˆ¶åŒºå¸ƒå±€ */
.right-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}
/* åµŒå…¥å¼ä¸Šä¼ çŠ¶æ€ */
.inline-upload-panel {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-right: 15px;
  padding: 4px 10px;
  background-color: #f0f9eb;
  border-radius: 15px;
  border: 1px solid #e1f3d8;
  font-size: 12px;
  color: #67c23a;
  height: 32px;
  box-sizing: border-box;
}
.mini-progress-bar {
  width: 60px;
  height: 6px;
  background-color: #e1f3d8;
  border-radius: 3px;
  overflow: hidden;
}
.bar-inner {
  height: 100%;
  background-color: #67c23a;
  transition: width 0.3s ease;
}

/* 2.2 æ–‡ä»¶åˆ—è¡¨ */
.file-list-container {
  flex-grow: 1;
  position: relative;
  overflow-y: hidden;
}
.icon-view-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}
:deep(.el-table .el-table__cell.is-right .cell) {
  justify-content: flex-end;
}
:deep(.unselectable-file) {
  color: var(--el-text-color-disabled);
  cursor: not-allowed;
}
:deep(.unselectable-file .el-icon) {
  opacity: 0.6;
}
:deep(.unselectable-file:hover > td) {
  background-color: transparent !important; /* ç¦ç”¨ hover æ•ˆæœ */
}
/* [æ–°å¢] å†…è”é‡å‘½åè¾“å…¥æ¡†æ ·å¼ */
.rename-container {
  display: flex;
  align-items: center;
  width: 100%;
}
.icon-rename {
  width: 110px; /* ç¨å¾®æ¯”å›¾æ ‡æ ¼å®½ä¸€ç‚¹ */
  margin-top: 5px;
}
/* è¦†ç›– el-input é»˜è®¤æ ·å¼ï¼Œè®©å…¶æ›´ç´§å‡‘ */
:deep(.rename-input .el-input__wrapper) {
  padding: 1px 5px;
  box-shadow: 0 0 0 1px #409eff inset;
}

.footer-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  border-top: 1px solid var(--el-border-color);
  flex-shrink: 0;
}
.selected-info {
  color: var(--el-text-color-secondary);
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding-right: 10px;
}
/* 3. å›¾æ ‡è§†å›¾æ ·å¼ */
.icon-view-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 2px; /* å›¾æ ‡ä¹‹é—´çš„é—´è·ï¼Œæ›¿ä»£ä¹‹å‰çš„ margin */
  padding: 12px;
  height: 100%;
  overflow-y: auto;
  align-content: flex-start; /* å†…å®¹ä¸è¶³ä¸€å±æ—¶é ä¸Šå¯¹é½ */
}
.icon-item {
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 5px 5px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s ease;
  user-select: none;
  -webkit-user-select: none;
}
.icon-item:hover {
  background-color: var(--el-fill-color-light);
}
.item-icon {
  font-size: 48px;
  margin-bottom: 8px;
  /* ä¸ºå›¾æ ‡é¢œè‰²ä¹Ÿæ·»åŠ è¿‡æ¸¡æ•ˆæœ */
  transition: color 0.2s ease;
}
.item-name {
  font-size: 13px;
  line-height: 1.3;
  text-align: center;
  word-break: break-all;
  /* å®ç°æœ€å¤šä¸¤è¡Œçš„æ–‡å­—æˆªæ–­ï¼Œå¹¶æ˜¾ç¤ºçœç•¥å· */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  overflow: hidden;
  text-overflow: ellipsis;
  height: 34px; /* æ ¹æ® line-height å’Œ font-size ä¼°ç®—å‡ºçš„ä¸¤è¡Œé«˜åº¦ */
}
/* é€‰ä¸­çŠ¶æ€çš„æ ·å¼ */
.icon-item.selected {
  background-color: var(--el-color-primary-light-9);
  border-color: var(--el-color-primary-light-7);
}
.icon-item.selected .item-icon {
  color: var(--el-color-primary);
}
/* ä¸å¯é€‰æ–‡ä»¶çš„æ ·å¼ */
.icon-item.unselectable-file {
  color: var(--el-text-color-disabled);
  cursor: not-allowed;
}
.icon-item.unselectable-file:hover {
  background-color: transparent; /* ç¦ç”¨ hover æ•ˆæœ */
}
.icon-item.unselectable-file .item-icon {
  opacity: 0.6;
}
/* æ‹–æ‹½é®ç½©å±‚ */
.drag-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(64, 158, 255, 0.85); /* è“è‰²åŠé€æ˜ */
  z-index: 2000; /* ä¿è¯åœ¨æœ€ä¸Šå±‚ */
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 8px;
  border: 4px dashed #fff;
  margin: 10px; /* ç•™ä¸€ç‚¹è¾¹è· */
  pointer-events: auto; /* å¿…é¡»æ¥æ”¶é¼ æ ‡äº‹ä»¶æ‰èƒ½è§¦å‘ drop */
}
.drag-content {
  text-align: center;
  color: #fff;
}
.drag-content h3 {
  margin-top: 20px;
  font-size: 18px;
  font-weight: 500;
}
/* ä¸Šä¼ å¼¹çª—æ ·å¼å¾®è°ƒ */
.upload-progress-content {
  padding: 10px 0;
}
.upload-filename {
  margin-bottom: 10px;
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.upload-queue-info {
  margin-top: 10px;
  text-align: right;
  color: #909399;
  font-size: 12px;
}

/* 1. é™åˆ¶å·¦ä¾§æ§ä»¶å®¹å™¨ï¼Œé˜²æ­¢å®ƒæ— é™æ’‘å¼€ */
.left-controls {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
  min-width: 0; /* [å…³é”®] å…è®¸ Flex å­å…ƒç´ ç¼©å°åˆ°å†…å®¹å®½åº¦ä»¥ä¸‹ */
  overflow: hidden; /* é˜²æ­¢æº¢å‡º */
}

/* 2. å†å²æŒ‰é’®ç»„ä¿æŒå›ºå®šï¼Œä¸è®¸ç¼©å° */
.history-nav {
  flex-shrink: 0;
}

/* 3. é¢åŒ…å±‘æ»šåŠ¨å®¹å™¨ */
.breadcrumb-wrapper {
  flex: 1; /* å æ®å‰©ä½™æ‰€æœ‰ç©ºé—´ */
  overflow-x: auto; /* å…è®¸æ¨ªå‘æ»šåŠ¨ */
  overflow-y: hidden; /* ç¦æ­¢çºµå‘æ»šåŠ¨ */
  white-space: nowrap; /* [å…³é”®] å¼ºåˆ¶å†…å®¹åœ¨ä¸€è¡Œæ˜¾ç¤º */

  /* éšè—æ»šåŠ¨æ¡ (Chrome/Safari) */
  &::-webkit-scrollbar {
    display: none;
  }
  /* éšè—æ»šåŠ¨æ¡ (Firefox) */
  scrollbar-width: none;

  /* [å¯é€‰] ä¸¤ä¾§æ·»åŠ é®ç½©æ¸å˜ï¼Œæç¤ºç”¨æˆ·è¿˜æœ‰å†…å®¹ */
  mask-image: linear-gradient(
    to right,
    transparent,
    black 10px,
    black calc(100% - 10px),
    transparent
  );
  -webkit-mask-image: linear-gradient(
    to right,
    transparent,
    black 10px,
    black calc(100% - 10px),
    transparent
  );

  /* å¢åŠ ä¸€ç‚¹å†…è¾¹è·ï¼Œé˜²æ­¢æ–‡å­—è´´è¾¹ */
  padding: 0 5px;
}

/* 4. é¢åŒ…å±‘ç»„ä»¶æœ¬ä½“ */
.breadcrumb-nav {
  display: inline-flex; /* é…åˆ wrapper çš„ nowrap */
  align-items: center;
  flex-wrap: nowrap !important; /* [å…³é”®] å¼ºåˆ¶ Element Plus ä¸æ¢è¡Œ */
}

/* ä¿®å¤ Element Plus é¢åŒ…å±‘é¡¹å¯èƒ½è‡ªå¸¦çš„æ¢è¡Œ */
:deep(.el-breadcrumb__item) {
  float: none; /* è¦†ç›–é»˜è®¤ float */
  display: inline-flex;
  align-items: center;
}

/* è®©æœ€åä¸€é¡¹ï¼ˆå½“å‰ç›®å½•ï¼‰ç¨å¾®åŠ ç²—ï¼Œä¸”ä¸è®¸è¢«æŒ¤å‹ */
:deep(.el-breadcrumb__item:last-child .el-breadcrumb__inner) {
  font-weight: 600;
  color: #303133;
}

.close-button {
  border: none;
  padding: 0;
  font-size: 16px;
}
</style>

<style>
/* æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ scopedï¼Œæ˜¯ä¸ºäº†è¦†ç›–æŒ‚è½½åœ¨ body ä¸Šçš„èœå•æ ·å¼ */
.mx-context-menu {
  z-index: 9999 !important; /* å¼ºåˆ¶å±‚çº§æœ€é«˜ï¼Œç›–è¿‡ Element Plus çš„ Dialog */
  background-color: var(--el-bg-color-overlay) !important; /* ç¡®ä¿æœ‰èƒŒæ™¯è‰² */
  border: 1px solid var(--el-border-color-light) !important;
  box-shadow: var(--el-box-shadow-light) !important;
}

/* ä¿®å¤èœå•é¡¹çš„æ ·å¼ï¼Œä½¿å…¶æ›´è´´åˆ Element Plus ä¸»é¢˜ */
.mx-context-menu-item {
  color: var(--el-text-color-primary) !important;
  font-family: inherit !important;
}
.mx-context-menu-item:hover {
  background-color: var(--el-color-primary-light-9) !important;
  color: var(--el-color-primary) !important;
}
</style>


--- File: src/renderer/src/components/FirstTimeSetupDialog.vue ---
<template>
  <el-dialog
    v-model="visible"
    title="é¦–æ¬¡éƒ¨ç½² Agent"
    width="480px"
    :close-on-click-modal="false"
    append-to-body
  >
    <el-form ref="formRef" :model="form" label-position="top">
      <el-alert type="info" :closable="false" style="margin-bottom: 20px">
        æ­¤åŠŸèƒ½å°†é€šè¿‡ SSH è¿æ¥åˆ°ä½ çš„æœºå™¨äººï¼Œè‡ªåŠ¨ä¸Šä¼ å¹¶å®‰è£… Agent å®ˆæŠ¤è¿›ç¨‹ã€‚
      </el-alert>

      <!-- IP åœ°å€ (å¸¦è‡ªåŠ¨è¡¥å…¨) -->
      <el-form-item
        label="æœºå™¨äºº IP åœ°å€"
        prop="host"
        :rules="{ required: true, message: 'IP åœ°å€ä¸èƒ½ä¸ºç©º' }"
      >
        <template #label>
          <div style="display: flex; justify-content: space-between; align-items: center">
            <span>æœºå™¨äºº IP åœ°å€</span>
            <span v-if="sshDevices.length > 0" style="color: #67c23a; font-size: 12px">
              <el-icon style="vertical-align: middle"><Connection /></el-icon> å‘ç°
              {{ sshDevices.length }} ä¸ª SSH è®¾å¤‡
            </span>
            <span v-else style="color: #909399; font-size: 12px">
              <el-icon class="is-loading" style="vertical-align: middle"><Loading /></el-icon>
              æ­£åœ¨æ‰«æ SSH...
            </span>
          </div>
        </template>
        <el-autocomplete
          v-model="form.host"
          :fetch-suggestions="querySearch"
          placeholder="ä¾‹å¦‚: 192.168.1.10"
          style="width: 100%"
          trigger-on-focus
          clearable
          @select="handleSelect"
        >
          <template #default="{ item }">
            <div style="display: flex; flex-direction: column; line-height: 1.2; padding: 4px 0">
              <span style="font-weight: bold">{{ item.hostname }}</span>
              <span style="font-size: 12px; color: #999">{{ item.value }}</span>
            </div>
          </template>
        </el-autocomplete>
      </el-form-item>

      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="SSH ç«¯å£" prop="port">
            <el-input-number
              v-model="form.port"
              :min="1"
              :max="65535"
              controls-position="right"
              style="width: 100%"
            />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="ç›®æ ‡æ¶æ„" prop="arch">
            <el-select v-model="form.arch" placeholder="é€‰æ‹©æ¶æ„">
              <el-option label="ARM64 (æ ‘è“æ´¾/Jetson)" value="arm64" />
              <el-option label="AMD64 (PC/NUC)" value="amd64" />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>

      <el-form-item
        label="ç”¨æˆ·å"
        prop="username"
        :rules="{ required: true, message: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º' }"
      >
        <el-input v-model="form.username" placeholder="ä¾‹å¦‚: ubuntu æˆ– root" />
      </el-form-item>

      <el-form-item label="å¯†ç " prop="password">
        <el-input
          v-model="form.password"
          type="password"
          show-password
          placeholder="è¯·è¾“å…¥ Sudo å¯†ç  (ç”¨äºå®‰è£…æœåŠ¡)"
        />
      </el-form-item>

      <!-- é™„åŠ ç»„ä»¶å®‰è£…é€‰é¡¹ -->
      <el-form-item>
        <el-checkbox v-model="form.installFoxglove" border>
          åŒæ—¶å®‰è£… Foxglove Bridge (ROS Noetic)
        </el-checkbox>
        <div style="font-size: 12px; color: #909399; line-height: 1.2; margin-top: 5px">
          * ç›®æ ‡ä¸»æœºéœ€è¦æœ‰äº’è”ç½‘è¿æ¥
        </div>
      </el-form-item>
    </el-form>

    <div v-if="isDeploying" class="progress-overlay">
      <div class="progress-content">
        <el-progress type="circle" :percentage="progress.percent" />
        <p class="progress-text">{{ progress.message }}</p>
      </div>
    </div>

    <template #footer>
      <span class="dialog-footer">
        <el-button @click="visible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" :loading="isDeploying" @click="handleDeploy">
          è¿æ¥å¹¶éƒ¨ç½²
        </el-button>
      </span>
    </template>
  </el-dialog>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.progress-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  z-index: 10;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 4px;
}
.progress-content {
  text-align: center;
}
.progress-text {
  margin-top: 15px;
  font-size: 14px;
  color: #606266;
  font-weight: 500;
}
</style>


--- File: src/renderer/src/components/NodeParamsList.vue ---
<template>
  <div class="params-list-container">
    <div class="params-header">
      <span>å…³è”å‚æ•°æ–‡ä»¶</span>
      <el-button link type="primary" size="small" @click="addParam">
        <el-icon><Plus /></el-icon> æ·»åŠ 
      </el-button>
    </div>

    <div v-if="params.length === 0" class="empty-params">æ— å…³è”æ–‡ä»¶</div>

    <div v-else class="params-items">
      <div v-for="(param, index) in params" :key="index" class="param-row">
        <!-- 1. å‚æ•°åç§° (å¯ç¼–è¾‘) -->
        <el-input
          v-model="param.name"
          size="small"
          class="param-name-input"
          :placeholder="`å‚æ•°${index + 1}`"
          @change="triggerSave"
        />

        <!-- 2. è·¯å¾„æŒ‰é’® -->
        <el-button
          size="small"
          class="param-path-btn"
          :title="param.path"
          @click="$emit('pick-file', param)"
        >
          {{ getFileName(param.path) || 'é€‰æ‹©æ–‡ä»¶' }}
        </el-button>

        <!-- 3. æ“ä½œæŒ‰é’®ç»„ -->
        <div class="param-actions">
          <!-- ç¼–è¾‘å†…å®¹ -->
          <el-button
            link
            type="primary"
            size="small"
            :icon="EditPen"
            :disabled="!param.path"
            title="ç¼–è¾‘æ–‡ä»¶å†…å®¹"
            @click="openEditor(param.path)"
          />
          <!-- åˆ é™¤æ¡ç›® -->
          <el-button
            link
            type="danger"
            size="small"
            :icon="Delete"
            title="ç§»é™¤å…³è”"
            @click="removeParam(index)"
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.params-list-container {
  background-color: #f5f7fa; /* ç¨å¾®æ·±ä¸€ç‚¹çš„èƒŒæ™¯ï¼ŒåŒºåˆ†äº Card */
  border: 1px solid #e4e7ed;
  border-top: none; /* å»æ‰ä¸Šè¾¹æ¡†ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒä» Card å»¶ä¼¸å‡ºæ¥çš„ */
  border-radius: 0 0 4px 4px; /* åªæœ‰åº•éƒ¨åœ†è§’ */
  padding: 10px 15px;
  margin: 0 4px; /* ç¨å¾®ç¼©è¿›ä¸€ç‚¹ï¼Œè¥é€ å±‚æ¬¡æ„Ÿï¼Œæˆ–è€…è®¾ä¸º 0 ä¸å¡ç‰‡ç­‰å®½ */
  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.05);
}

.params-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #909399;
  margin-bottom: 8px;
}

.empty-params {
  text-align: center;
  color: #c0c4cc;
  font-size: 12px;
  padding: 5px 0;
}

.param-row {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-bottom: 5px;
}

.param-name-input {
  width: 80px;
  flex-shrink: 0;
}

.param-path-btn {
  flex-grow: 1;
  justify-content: flex-start;
  overflow: hidden;
  text-overflow: ellipsis;
  color: #606266;
}

.param-actions {
  display: flex;
  flex-shrink: 0;
}
</style>


--- File: src/renderer/src/components/SettingsDialog.vue ---
<template>
  <el-dialog
    v-model="visible"
    title="å…¨å±€è®¾ç½®"
    width="500px"
    :close-on-click-modal="false"
    append-to-body
  >
    <el-form label-position="left" label-width="200px">
      <el-divider content-position="left">å¯åŠ¨ä¸è¿æ¥</el-divider>

      <el-form-item label="ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥">
        <template #label>
          <span>å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥</span>
          <el-tooltip content="å¯åŠ¨ç¨‹åºæ—¶è‡ªåŠ¨å°è¯•è¿æ¥ä¸Šæ¬¡ä½¿ç”¨çš„æœºå™¨äºº" placement="top">
            <el-icon class="help-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-switch v-model="form.autoConnect" />
      </el-form-item>

      <el-form-item label="è¿æ¥åè‡ªåŠ¨å¯åŠ¨æœåŠ¡">
        <template #label>
          <span>è¿æ¥åè‡ªåŠ¨å¯åŠ¨æœåŠ¡</span>
          <el-tooltip content="è¿æ¥å»ºç«‹åï¼Œè‡ªåŠ¨å‘é€æŒ‡ä»¤å¯åŠ¨ Roscore å’Œ Bridge" placement="top">
            <el-icon class="help-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-switch v-model="form.autoStartRos" />
      </el-form-item>

      <el-divider content-position="left">æ–­å¼€ä¸æ¸…ç†</el-divider>

      <el-form-item label="æ–­å¼€æ—¶åœæ­¢ Bridge">
        <template #label>
          <span>æ–­å¼€æ—¶åœæ­¢ Bridge</span>
          <el-tooltip content="æ‰‹åŠ¨æ–­å¼€è¿æ¥æ—¶ï¼Œè‡ªåŠ¨åœæ­¢ Foxglove Bridge æ•°æ®æ¡¥" placement="top">
            <el-icon class="help-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-switch v-model="form.autoStopBridge" />
      </el-form-item>

      <el-form-item label="æ–­å¼€æ—¶åœæ­¢ Roscore">
        <template #label>
          <span>æ–­å¼€æ—¶åœæ­¢ Roscore</span>
          <el-tooltip
            content="æ‰‹åŠ¨æ–­å¼€è¿æ¥æ—¶ï¼Œè‡ªåŠ¨åœæ­¢ Roscore (è­¦å‘Šï¼šä¼šå½±å“å…¶ä»–èŠ‚ç‚¹)"
            placement="top"
          >
            <el-icon class="help-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-switch v-model="form.autoStopRoscore" />
      </el-form-item>

      <el-divider content-position="left">å±é™©åŒºåŸŸ</el-divider>

      <div class="danger-zone">
        <p>æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„è¿æ¥åˆ—è¡¨ã€èŠ‚ç‚¹é…ç½®å’Œä½¿ç”¨ä¹ æƒ¯ã€‚</p>
        <el-button type="danger" plain size="small" @click="handleReset">é‡ç½®æ‰€æœ‰é…ç½®</el-button>
      </div>
    </el-form>

    <template #footer>
      <el-button @click="visible = false">å…³é—­</el-button>
    </template>
  </el-dialog>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.help-icon {
  margin-left: 4px;
  color: #909399;
  cursor: help;
  vertical-align: middle;
}
.danger-zone {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #fef0f0;
  padding: 10px;
  border-radius: 4px;
}
.danger-zone p {
  margin: 0;
  font-size: 12px;
  color: #f56c6c;
}
</style>


--- File: src/renderer/src/components/Versions.vue ---
<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<template>
  <ul class="versions">
    <li class="electron-version">Electron v{{ versions.electron }}</li>
    <li class="chrome-version">Chromium v{{ versions.chrome }}</li>
    <li class="node-version">Node v{{ versions.node }}</li>
  </ul>
</template>


--- File: src/renderer/src/components/log/LogPanel.vue ---
<!-- src/renderer/src/components/LogPanel.vue -->
<template>
  <div class="log-panel">
    <el-tabs
      v-model="activeTab"
      type="card"
      class="level-2-tabs"
      :before-leave="handleBeforeTabLeave"
      @tab-remove="handleTabRemove"
    >
      <!-- 1. èŠ‚ç‚¹æ—¥å¿— Tabs -->
      <el-tab-pane
        v-for="nodeId in nodeLogKeys"
        :key="nodeId"
        :name="nodeId"
        :label="nodeId"
        :closable="!isNodeRunning(nodeId)"
      >
        <template #label>
          <span :class="['status-dot', isNodeRunning(nodeId) ? 'running' : 'stopped']"></span>
          {{ nodeId }}
        </template>
        <LogViewer
          :ref="(el) => setViewerRef(nodeId, el)"
          mode="log"
          :lines="getNodeLog(nodeId).lines"
        />
      </el-tab-pane>

      <!-- 2. äº¤äº’ç»ˆç«¯ Tabs -->
      <el-tab-pane
        v-for="term in terminals"
        :key="`term-${term.id}`"
        :name="`term-${term.id}`"
        :label="term.name"
        closable
      >
        <LogViewer
          :ref="(el) => setViewerRef(`term-${term.id}`, el)"
          mode="terminal"
          :host-ip="clientIp"
        />
      </el-tab-pane>

      <!-- 3. ã€ä¿®å¤ã€‘è‡ªå®šä¹‰æ·»åŠ æŒ‰é’® Tab -->
      <!-- è¿™æ˜¯ä¸€ä¸ªä¼ª Tabï¼Œä¸å¯å…³é—­ï¼Œç‚¹å‡»å®ƒä¼šè§¦å‘æ·»åŠ é€»è¾‘ä½†ä¸ä¼šçœŸçš„é€‰ä¸­ -->
      <el-tab-pane name="__add_tab__" :closable="false">
        <template #label>
          <span class="add-tab-btn">
            <el-icon><Plus /></el-icon>
          </span>
        </template>
      </el-tab-pane>
    </el-tabs>

    <!-- ç©ºçŠ¶æ€æŒ‡å¼• -->
    <div v-if="nodeLogKeys.length === 0 && terminals.length === 0" class="empty-guide">
      <el-empty description="æš‚æ— æ´»åŠ¨æ—¥å¿—">
        <el-button type="primary" @click="triggerAddTerminal">æ–°å»ºç»ˆç«¯</el-button>
      </el-empty>
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.log-panel {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.level-2-tabs {
  height: 100%;
  display: flex;
  flex-direction: column;
}
:deep(.el-tabs__content) {
  flex: 1;
  padding: 0;
  overflow: hidden;
}
:deep(.el-tab-pane) {
  height: 100%;
}
.empty-guide {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.status-dot {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  margin-right: 5px;
  vertical-align: middle;
}
.status-dot.running {
  background-color: #67c23a;
}
.status-dot.stopped {
  background-color: #909399;
}
.add-tab-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: 16px;
}
</style>


--- File: src/renderer/src/components/log/LogViewer.vue ---
<!-- src/renderer/src/components/LogViewer.vue -->
<template>
  <div ref="terminalContainer" class="terminal-container"></div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.terminal-container {
  width: 100%;
  height: 100%;
  background-color: #1e1e1e;
  box-sizing: border-box;
  overflow: hidden; /* è‡ªèº«ä¸æ»šåŠ¨ï¼Œè®© xterm å†…éƒ¨æ»šåŠ¨ */
}
</style>


--- File: src/renderer/src/components/monitor/DataVisualizer.vue ---
<template>
  <div class="data-visualizer">
    <div v-if="data === undefined || data === null" class="no-data">æš‚æ— æ•°æ®</div>
    <div v-else class="json-container">
      <!-- ç®€å•å€¼ -->
      <div v-if="!isComplex(data)">
        <span class="value">{{ data }}</span>
      </div>

      <div v-for="(val, key) in data" v-else :key="key" class="data-row">
        <span class="key">{{ key }}:</span>

        <!-- 1. æ—¶é—´æˆ³ -->
        <template v-if="isTimestamp(val)">
          <span class="value number">{{ formatTime(val) }}</span>
        </template>

        <!-- 2. çœŸæ­£çš„äºŒè¿›åˆ¶ (Uint8Array) -->
        <template v-else-if="isTrueBinary(val)">
          <span class="value array">[Binary Stream: {{ val.byteLength }} bytes]</span>
        </template>

        <!-- 3. TypedArray (Float64Array ç­‰) -> è½¬ä¸ºæ™®é€šæ•°ç»„æ˜¾ç¤º -->
        <template v-else-if="isTypedArray(val)">
          <!-- å¦‚æœæ•°æ®å¤ªé•¿ (æ¯”å¦‚ç‚¹äº‘)ï¼Œåªæ˜¾ç¤ºå‰å‡ ä¸ª -->
          <span v-if="val.length > 20" class="value array">
            [{{ val.constructor.name }}({{ val.length }})] {{ formatLargeArray(val) }}
          </span>
          <div v-else class="nested">
            <span class="value number">{{ Array.from(val).join(', ') }}</span>
          </div>
        </template>

        <!-- 4. æ™®é€šå¯¹è±¡ -->
        <template v-else-if="isPlainObject(val)">
          <div class="nested">
            <DataVisualizer :data="val" />
          </div>
        </template>

        <!-- 5. æ™®é€šæ•°ç»„ -->
        <template v-else-if="Array.isArray(val)">
          <span v-if="val.length > 20" class="value array">[Array({{ val.length }})] ...</span>
          <div v-else class="nested">
            <DataVisualizer :data="val" />
          </div>
        </template>

        <!-- 6. å…œåº• -->
        <template v-else>
          <span class="value" :class="typeof val">{{ val }}</span>
        </template>
      </div>
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.data-visualizer {
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 12px;
  line-height: 1.5;
  color: #d4d4d4;
  overflow-x: hidden;
}
.no-data {
  color: #666;
  font-style: italic;
}
.json-container {
  padding-left: 4px;
}
.data-row {
  display: flex;
  flex-wrap: wrap;
  margin-bottom: 2px;
}
.key {
  color: #9cdcfe;
  margin-right: 8px;
  font-weight: 600;
  min-width: 80px;
}
.nested {
  width: 100%;
  border-left: 1px solid #444;
  margin-left: 4px;
  padding-left: 8px;
}
.value {
  word-break: break-all;
}
.value.string {
  color: #ce9178;
}
.value.number {
  color: #b5cea8;
}
.value.boolean {
  color: #569cd6;
}
.value.array {
  color: #dcdcaa;
  font-style: italic;
}
</style>


--- File: src/renderer/src/components/monitor/ImageVisualizer.vue ---
<!-- src/renderer/src/components/monitor/ImageVisualizer.vue -->
<template>
  <div class="image-container">
    <img v-if="imgSrc" :src="imgSrc" alt="Stream" class="live-image" />
    <div v-else class="placeholder">ç­‰å¾…å›¾åƒæµ...</div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.image-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  overflow: hidden;
}
.live-image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}
.placeholder {
  color: #555;
}
</style>


--- File: src/renderer/src/components/monitor/MonitorCard.vue ---
<template>
  <div class="monitor-card-container">
    <div class="card-header drag-handle">
      <div class="header-left">
        <!-- 1. é€‰æ‹©æœºå™¨äºº -->
        <el-select
          v-model="localConfig.backendId"
          placeholder="é€‰æ‹©æœºå™¨äºº"
          size="small"
          class="robot-select"
          @change="handleRobotChange"
          @mousedown.stop
        >
          <el-option
            v-for="robot in activeRobots"
            :key="robot.id"
            :label="robot.name"
            :value="robot.id"
          />
        </el-select>

        <!-- 2. é€‰æ‹©è¯é¢˜ -->
        <!-- å¢åŠ  :key å¼ºåˆ¶é‡æ¸²æŸ“ -->
        <el-select
          :key="localConfig.backendId"
          v-model="currentSelectId"
          placeholder="é€‰æ‹©è¯é¢˜"
          size="small"
          filterable
          class="topic-select"
          :disabled="!localConfig.backendId"
          @change="handleTopicChange"
          @mousedown.stop
        >
          <el-option
            v-for="ch in sortedAndFilteredChannels"
            :key="ch.id"
            :label="ch.topic"
            :value="ch.id"
          >
            <span style="float: left">{{ ch.topic }}</span>
            <span style="float: right; color: #666; font-size: 10px; margin-left: 10px">{{
              formatType(ch.schemaName)
            }}</span>
          </el-option>
        </el-select>

        <span v-if="messageRate > 0" class="rate-tag">{{ messageRate }} Hz</span>
      </div>

      <div class="header-right" @mousedown.stop>
        <el-icon class="close-btn" @click="$emit('remove')"><Close /></el-icon>
      </div>
    </div>

    <div class="card-body" @mousedown.stop>
      <el-empty v-if="!localConfig.backendId" description="è¯·é€‰æ‹©æœºå™¨äºº" :image-size="60" />
      <el-empty v-else-if="!localConfig.topicName" description="è¯·é€‰æ‹©è¯é¢˜" :image-size="60" />

      <component :is="visualizerComponent" v-else :data="visualizedData" :topic-type="topicType" />
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
/* ä¿æŒåŸæœ‰æ ·å¼ */
.monitor-card-container {
  width: 100%;
  height: 100%;
  background: #1e1e1e;
  border: 1px solid #333;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.card-header {
  height: 36px;
  background: #2d2d2d;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 8px;
  cursor: move;
  border-bottom: 1px solid #333;
}
.header-left {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
  min-width: 0;
}
.robot-select {
  width: 110px;
}
.topic-select {
  flex: 1;
  min-width: 100px;
}
.rate-tag {
  font-size: 10px;
  color: #67c23a;
  background: #222;
  padding: 2px 4px;
  border-radius: 2px;
  white-space: nowrap;
}
.close-btn {
  cursor: pointer;
  color: #909399;
}
.close-btn:hover {
  color: #f56c6c;
}
.card-body {
  flex: 1;
  overflow: auto;
  background: #141414;
  position: relative;
}

/* æ»šåŠ¨æ¡ */
.card-body::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
.card-body::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 3px;
}
</style>


--- File: src/renderer/src/views/Dashboard.vue ---
<!-- src/renderer/src/components/Dashboard.vue -->
<template>
  <el-container class="dashboard">
    <!-- èŠ‚ç‚¹æ§åˆ¶éƒ¨åˆ† -->
    <el-aside class="node-list-panel">
      <div
        v-for="node in nodes"
        :key="node.id || node.name"
        class="node-wrapper"
        @mouseenter="node.showEdit = true"
        @mouseleave="node.showEdit = false"
      >
        <el-card class="node-card" :class="{ 'is-editing': editingNodeId === node.id }">
          <template #header>
            <div class="card-header">
              <div class="header-row">
                <el-tag size="small" :type="statusType(node.status)" />
              </div>
              <div class="header-row">
                <!-- ç¼–è¾‘æ¨¡å¼çš„æ ‡é¢˜è¾“å…¥æ¡† -->
                <el-input
                  v-if="editingNodeId === node.id"
                  v-model="form.name"
                  placeholder="Display Name"
                  size="small"
                  class="name-input"
                />
                <!-- æ˜¾ç¤ºæ¨¡å¼çš„æ ‡é¢˜ -->
                <span v-else class="node-name">{{ node.name }}</span>
              </div>
            </div>
          </template>

          <!-- å¡ç‰‡å†…å®¹éƒ¨åˆ† -->
          <div class="card-body-content">
            <!-- ç¼–è¾‘æ¨¡å¼ -->
            <div v-if="editingNodeId === node.id" class="launch-edit-row">
              <el-button class="launch-path-button" @click="openFileBrowser('launch')">
                {{ getDisplayPath(form.args) || 'é€‰æ‹©å¯åŠ¨æ–‡ä»¶' }}
              </el-button>
              <!-- ç¼–è¾‘ Launch å†…å®¹æŒ‰é’® -->
              <el-tooltip content="ç¼–è¾‘ Launch æ–‡ä»¶" placement="top">
                <el-button
                  :icon="EditPen"
                  type="primary"
                  plain
                  class="launch-content-edit-btn"
                  :disabled="!getDisplayPath(form.args)"
                  @click="openLaunchEditor"
                />
              </el-tooltip>
            </div>
            <!-- æ˜¾ç¤ºæ¨¡å¼ -->
            <p v-else class="launch-path">{{ getDisplayPath(node.args) }}</p>
          </div>

          <template #footer>
            <div class="card-footer">
              <!-- ç¼–è¾‘æ¨¡å¼: æ˜¾ç¤º Save/Cancel æŒ‰é’® -->
              <div v-if="editingNodeId === node.id" class="footer-edit-actions">
                <el-button type="primary" size="small" round @click.stop="saveNode">ä¿å­˜</el-button>
                <el-button size="small" round @click.stop="cancelEditing">å–æ¶ˆ</el-button>
              </div>

              <!-- æ˜¾ç¤ºæ¨¡å¼: æ˜¾ç¤º å¯åŠ¨/åœæ­¢ å’Œ ç¼–è¾‘æŒ‰é’® -->
              <div v-else class="footer-display-actions">
                <!-- åˆ é™¤å›¾æ ‡ï¼ˆå’Œç¼–è¾‘å›¾æ ‡åŒæ ·å¼ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªclassï¼‰ -->
                <el-button
                  v-show="node.showEdit"
                  class="delete-icon-btn"
                  :icon="Delete"
                  type="danger"
                  circle
                  link
                  :disabled="!isCurrentBackendReady || node.status !== 'stopped'"
                  @click.stop="deleteNode(node)"
                />
                <!-- ç¼–è¾‘å›¾æ ‡ -->
                <el-button
                  v-show="node.showEdit"
                  class="edit-icon-btn"
                  :icon="Edit"
                  :disabled="!isCurrentBackendReady || node.status !== 'stopped'"
                  type="primary"
                  circle
                  link
                  @click.stop="startEditing(node)"
                />
                <el-button
                  class="start-stop-btn"
                  :type="
                    node.status === 'starting'
                      ? 'primary'
                      : node.status === 'stopping'
                        ? 'danger'
                        : node.status === 'running'
                          ? 'danger'
                          : 'primary'
                  "
                  :loading="node.status === 'starting' || node.status === 'stopping'"
                  :disabled="
                    node.status === 'starting' ||
                    node.status === 'stopping' ||
                    !isCurrentBackendReady
                  "
                  round
                  @click="toggleNode(node)"
                >
                  {{
                    node.status === 'starting'
                      ? 'å¯åŠ¨'
                      : node.status === 'stopping'
                        ? 'åœæ­¢'
                        : node.status === 'running'
                          ? 'åœæ­¢'
                          : 'å¯åŠ¨'
                  }}
                </el-button>
              </div>
            </div>
          </template>
        </el-card>

        <!-- 2. å‚æ•°åˆ—è¡¨é¢æ¿ (ç‹¬ç«‹äº Card) -->
        <el-collapse-transition>
          <div v-show="node.showEdit && editingNodeId !== node.id" class="params-drawer">
            <NodeParamsList
              :node="node"
              :backend-id="props.currentBackendId"
              @update-node="handleNodeUpdate"
              @pick-file="(param) => openFileBrowser('param', param)"
            />
          </div>
        </el-collapse-transition>
      </div>

      <!-- â€œæ–°å¢èŠ‚ç‚¹â€å¡ç‰‡ -->
      <el-card v-if="editingNodeId === '__new__'" class="node-card is-editing">
        <template #header>
          <div class="card-header">
            <div class="header-row">
              <el-tag size="small" type="info" />
            </div>
            <div class="header-row">
              <el-input
                v-model="form.name"
                placeholder="èŠ‚ç‚¹åç§°"
                size="small"
                class="name-input"
              />
            </div>
          </div>
        </template>
        <div class="card-body-content">
          <el-button class="launch-path-button" @click="openFileBrowser('launch')">
            {{ getDisplayPath(form.args) || 'é€‰æ‹©launchæ–‡ä»¶' }}
          </el-button>
        </div>
        <template #footer>
          <div class="card-footer">
            <div class="footer-edit-actions">
              <el-button type="primary" size="small" @click.stop="saveNode">æ·»åŠ </el-button>
              <el-button size="small" @click.stop="cancelEditing">å–æ¶ˆ</el-button>
            </div>
          </div>
        </template>
      </el-card>
      <!-- â€œæ·»åŠ æ–°èŠ‚ç‚¹â€çš„å ä½ç¬¦æŒ‰é’® -->
      <el-card
        v-else
        class="node-card add-new-card"
        :class="{ 'is-disabled': !isCurrentBackendReady }"
        @click="startAdding"
      >
        <span
          :style="{
            fontSize: '2.5vh',
            color: '#409EFF',
            marginLeft: '0.5vw'
          }"
          >+ æ·»åŠ æ–°èŠ‚ç‚¹</span
        >
      </el-card>
    </el-aside>
    <!-- å³ä¾§ï¼šåŠŸèƒ½åŒº -->
    <el-main class="function-panel">
      <div class="auto-start-panel">
        <div class="panel-header">
          <h2>ä¸€é”®å¯åŠ¨åºåˆ—</h2>
          <el-button
            type="primary"
            link
            :icon="CirclePlus"
            :disabled="!isCurrentBackendReady"
            @click="openSeqDialog(null)"
          >
            æ–°å»ºåºåˆ—
          </el-button>
        </div>

        <el-scrollbar height="calc(100% - 40px)">
          <div v-if="sequences.length === 0" class="empty-hint">æš‚æ— åºåˆ—</div>

          <div v-for="seq in sequences" :key="seq.id" class="seq-item">
            <div class="seq-info">
              <div class="seq-name">{{ seq.name }}</div>
              <div class="seq-desc">{{ seq.steps.length }} ä¸ªæ­¥éª¤</div>
            </div>
            <div class="seq-actions">
              <el-button
                circle
                size="small"
                :type="seq._status === 'running' ? 'danger' : 'success'"
                :icon="seq._status === 'running' ? VideoPause : VideoPlay"
                :loading="seq._status === 'running'"
                :disabled="!isCurrentBackendReady"
                @click="toggleSequence(seq)"
              />
              <el-button circle size="small" :icon="Edit" @click="openSeqDialog(seq)" />
              <el-button
                circle
                size="small"
                :icon="Delete"
                type="danger"
                plain
                @click="deleteSequence(seq)"
              />
            </div>
          </div>
        </el-scrollbar>
      </div>

      <div class="rosbag-panel">
        <div class="panel-header">
          <h2>ROSbag å½•åˆ¶</h2>
          <el-tag v-if="isRecording" type="danger" effect="dark" class="recording-tag">
            <span class="dot-blink">â—</span> REC
          </el-tag>
        </div>

        <!-- [ä¿®å¤ Bug 2] ç§»é™¤ el-form ä¸Šçš„ disabled å±æ€§ -->
        <el-form label-position="top" size="small">
          <el-row :gutter="10">
            <el-col :span="16">
              <el-form-item label="ä¿å­˜è·¯å¾„">
                <!-- [ä¿®æ”¹] åªæœ‰åœ¨å½•åˆ¶æ—¶ç¦ç”¨è¾“å…¥æ¡† -->
                <el-input
                  v-model="bagForm.path"
                  readonly
                  :disabled="isRecording"
                  @click="!isRecording && openFileBrowser('bag-path')"
                >
                  <template #append>
                    <el-button :disabled="isRecording" @click="openFileBrowser('bag-path')"
                      >é€‰æ‹©</el-button
                    >
                  </template>
                </el-input>
              </el-form-item>
            </el-col>
            <el-col :span="8">
              <el-form-item label="æ–‡ä»¶åå‰ç¼€">
                <el-input v-model="bagForm.name" placeholder="record" :disabled="isRecording" />
              </el-form-item>
            </el-col>
          </el-row>

          <el-form-item label="è¯é¢˜é€‰æ‹© (ç•™ç©ºåˆ™å½•åˆ¶æ‰€æœ‰)">
            <el-select
              v-model="bagForm.selectedTopics"
              multiple
              collapse-tags
              placeholder="All Topics (-a)"
              style="width: 100%"
              filterable
              :disabled="isRecording"
            >
              <el-option
                v-for="t in availableTopics"
                :key="t.topic"
                :label="t.topic"
                :value="t.topic"
              >
                <span style="float: left">{{ t.topic }}</span>
                <span style="float: right; color: #8492a6; font-size: 12px">{{
                  t.schemaName
                }}</span>
              </el-option>
            </el-select>
          </el-form-item>

          <el-row :gutter="10">
            <el-col :span="8">
              <el-form-item label="è‡ªåŠ¨åˆ†å‰²">
                <el-switch v-model="bagForm.split" :disabled="isRecording" />
              </el-form-item>
            </el-col>
            <el-col v-if="bagForm.split" :span="16">
              <el-form-item label="åˆ†å‰²å¤§å° (MB)">
                <el-input-number
                  v-model="bagForm.size"
                  :min="100"
                  :step="100"
                  :disabled="isRecording"
                />
              </el-form-item>
            </el-col>
          </el-row>

          <!-- [ä¿®å¤ Bug 1 & 2] æŒ‰é’®çŠ¶æ€é€»è¾‘ -->
          <el-button
            class="record-btn"
            :type="isRecording ? 'danger' : 'primary'"
            :icon="isRecording ? VideoPause : VideoPlay"
            :loading="false"
            :disabled="!isCurrentBackendReady || (!isRecording && !isRosServiceReady)"
            @click="toggleRecording"
          >
            <!-- 
              disabled é€»è¾‘è§£é‡Š:
              1. åç«¯æœªè¿æ¥ -> ç¦ç”¨
              2. æˆ–è€… (æ²¡åœ¨å½•åˆ¶ ä¸” ROSæœåŠ¡æ²¡å¥½) -> ç¦ç”¨ (é˜²æ­¢æœªå¯åŠ¨æœåŠ¡å°±å¼€å§‹)
              3. å¦‚æœæ­£åœ¨å½•åˆ¶ (isRecording=true)ï¼Œåˆ™å…è®¸ç‚¹å‡» (å› ä¸ºè¦åœæ­¢)
            -->
            {{ isRecording ? 'åœæ­¢å½•åˆ¶' : isRosServiceReady ? 'å¼€å§‹å½•åˆ¶' : 'ROS æœåŠ¡æœªå°±ç»ª' }}
          </el-button>
        </el-form>
      </div>
    </el-main>
  </el-container>
  <el-dialog
    v-model="fileBrowserContext.visible"
    class="file-browser-dialog"
    destroy-on-close
    :close-on-click-modal="false"
    :show-close="false"
    draggable
  >
    <div style="height: 100%; overflow: hidden">
      <FileBrowser
        :initial-path="fileBrowserContext.initialPath"
        :backend-id="props.currentBackendId"
        :allowed-extensions="fileBrowserContext.allowedExtensions"
        :show-close="true"
        :hide-footer="false"
        :target-type="fileBrowserContext.targetType"
        @file-selected="handleFileSelected"
        @cancel="handleCancel"
        @close="fileBrowserContext.visible = false"
      />
    </div>
  </el-dialog>
  <el-dialog
    v-model="isSeqDialogVisible"
    title="ç¼–è¾‘å¯åŠ¨åºåˆ—"
    width="500px"
    :close-on-click-modal="false"
    append-to-body
  >
    <el-form label-position="top">
      <el-form-item label="åºåˆ—åç§°">
        <el-input v-model="seqForm.name" placeholder="ä¾‹å¦‚: å…¨ç³»ç»Ÿå¯åŠ¨" />
      </el-form-item>

      <el-form-item label="æ‰§è¡Œæµç¨‹">
        <div class="timeline-editor">
          <el-timeline>
            <el-timeline-item
              v-for="(step, index) in seqForm.steps"
              :key="index"
              :type="step.type === 'node' ? 'primary' : 'warning'"
              :icon="step.type === 'delay' ? Timer : undefined"
              hide-timestamp
            >
              <div class="step-content">
                <!-- èŠ‚ç‚¹é€‰æ‹© -->
                <el-select
                  v-if="step.type === 'node'"
                  v-model="step.content"
                  placeholder="é€‰æ‹©èŠ‚ç‚¹"
                  size="small"
                  style="width: 200px"
                >
                  <el-option v-for="n in nodes" :key="n.id" :label="n.name" :value="n.id" />
                </el-select>

                <!-- å»¶æ—¶è¾“å…¥ -->
                <div v-else class="delay-input">
                  <span>ç­‰å¾…</span>
                  <el-input-number
                    v-model="step.content"
                    size="small"
                    :min="100"
                    :step="500"
                    controls-position="right"
                    style="width: 100px"
                  />
                  <span>ms</span>
                </div>

                <!-- åˆ é™¤æ­¥éª¤ -->
                <el-button link type="danger" :icon="Remove" @click="removeSeqStep(index)" />
              </div>
            </el-timeline-item>

            <!-- åº•éƒ¨æ·»åŠ æŒ‰é’® -->
            <el-timeline-item class="add-step-item">
              <el-button-group size="small">
                <el-button :icon="Plus" @click="addSeqStep('node')">èŠ‚ç‚¹</el-button>
                <el-button :icon="Timer" @click="addSeqStep('delay')">å»¶æ—¶</el-button>
              </el-button-group>
            </el-timeline-item>
          </el-timeline>
        </div>
      </el-form-item>
    </el-form>

    <template #footer>
      <el-button @click="isSeqDialogVisible = false">å–æ¶ˆ</el-button>
      <el-button type="primary" @click="saveSequence">ä¿å­˜</el-button>
    </template>
  </el-dialog>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.dashboard {
  height: 100%; /* å»æ‰paddingé«˜åº¦*/
  padding: 0;
  display: flex;
  flex-grow: 1;
  flex-direction: row;
}
/* ------ å·¦ä¾§å¡ç‰‡å®¹å™¨æ ·å¼ ------ */
.node-list-panel {
  padding: 1% 1% 1% 1%;
  border: 2px dashed #e4e7ed;
  width: 50%;
  height: 100%;
}
.node-wrapper {
  margin-bottom: 15px; /* å¡ç‰‡ä¹‹é—´çš„é—´è·ç§»åˆ°è¿™é‡Œ */
  display: flex;
  flex-direction: column;
}
.node-card {
  display: flex;
  align-items: center;
  border: rgba(144, 147, 153, 1);
  border-radius: 0px 40px 40px 0px;
  height: 75px;
  background-image: 
    /* ä¸Šå±‚ï¼šå†…å®¹èƒŒæ™¯è‰² (é€šå¸¸æ˜¯ç™½è‰²ï¼Œæˆ–è€…ç”¨ Element çš„å˜é‡ var(--el-bg-color)) */
    linear-gradient(var(--el-bg-color), var(--el-bg-color)),
    /* ä¸‹å±‚ï¼šæ¸å˜è¾¹æ¡†è‰² (ä»å·¦ä¸Šåˆ°å³ä¸‹ï¼Œå„ç§è“è‰²) */
      linear-gradient(135deg, #409eff, #8cc5ff, #ecf5ff);
  /* 4. èƒŒæ™¯è£å‰ªæ–¹å¼ */
  background-origin: border-box;
  background-clip: padding-box, border-box;
  /* 5. (å¯é€‰) æ·»åŠ ä¸€ç‚¹é˜´å½±è®©å®ƒæ›´ç«‹ä½“ */
  box-shadow: 0 2px 4px rgba(64, 158, 255, 0.15);
  transition: all 0.3s ease-out;
  margin-bottom: 10px;
  z-index: 2;
}
.node-card:hover {
  transform: scale(1.005); /* ä¿ç•™ä¹‹å‰çš„æ”¾å¤§æ•ˆæœ */
  margin-bottom: 0;
}
.node-card.has-params-open {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom-color: transparent; /* å¯é€‰ï¼šéšè—åº•è¾¹æ¡† */
  box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.1); /* å¢åŠ é˜´å½± */
}
.params-drawer {
  z-index: 1;
  margin-top: -5px;
}

/* å¤´éƒ¨å®¹å™¨æ ·å¼ */
.node-list-panel :deep(.el-card__header) {
  padding: 0px;
  display: flex;
  flex-direction: row;
  align-items: center;
  height: 80%;
  width: 25%; /* <-- è®¾å®šä¸€ä¸ªå›ºå®šçš„å®½åº¦ */
  flex-shrink: 0; /* <-- é˜²æ­¢å®ƒåœ¨ç©ºé—´ä¸è¶³æ—¶è¢«å‹ç¼© */
  border-right: 1px solid #e4e7ed; /* åœ¨ä¸­é—´åŠ ä¸€æ¡åˆ†å‰²çº¿ï¼Œæ›´ç¾è§‚ */
  border-bottom: none; /* Element Plus é»˜è®¤æœ‰ä¸‹è¾¹æ¡†ï¼Œå»æ‰å®ƒ */
  transition: none;
}
/* å¤´éƒ¨å†…å®¹æ ·å¼ */
.node-list-panel .el-card .card-header {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
}
.node-list-panel .el-card .header-row {
  display: flex;
  justify-content: flex-start; /* å·¦å³ä¸¤ç«¯å¯¹é½ */
  align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
  height: 100%;
  gap: 10px;
  position: relative;
}
.node-list-panel .el-card .header-row .node-name {
  font-size: 2.5vh;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.node-list-panel .el-card .header-row .el-input {
  height: 3vh;
  width: 90%;
  font-size: 2.5vh;
}
.node-list-panel .el-card .header-row .name-input :deep(.el-input__wrapper) {
  box-shadow: none !important; /* æ ¸å¿ƒï¼šå»æ‰é»˜è®¤è¾¹æ¡† */
  background-color: transparent; /* å»æ‰ç™½è‰²èƒŒæ™¯ï¼Œä½¿å…¶æ›´åƒçº¯æ–‡å­— */
  padding: 0 !important; /* æ ¸å¿ƒï¼šå»æ‰å·¦å³å†…è¾¹è·ï¼Œè®©æ–‡å­—ç´§è´´è¾¹ç¼˜ */
}
.node-list-panel .el-card .header-row .name-input :deep(.el-input__wrapper:hover),
.node-list-panel .el-card .header-row .name-input :deep(.el-input__wrapper.is-focus) {
  box-shadow: none !important; /* ç¡®ä¿äº¤äº’æ—¶ä¹Ÿä¸æ˜¾ç¤ºè¾¹æ¡† */
}
.node-list-panel .el-card .header-row .name-input :deep(.el-input__inner) {
  border: none !important;
  padding: 0 !important; /* ç¡®ä¿æ–‡å­—çœŸçš„ç´§è´´å·¦è¾¹ */
  height: auto; /* å¯é€‰ï¼šæ ¹æ®æ–‡å­—é«˜åº¦è‡ªé€‚åº”ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ 32px */
  line-height: 1.5; /* è°ƒæ•´è¡Œé«˜ä»¥åŒ¹é…æ™®é€šæ–‡æœ¬ */
}
.node-list-panel .el-card :deep(.card-header .el-tag) {
  border-radius: 0px;
  height: 100vh;
  width: 5px;
  padding: 0 0px;
  border: transparent;
  margin-right: 4px;
  transition: all 0.2s ease;
}
.node-list-panel .el-card .card-header:deep(.el-tag--success) {
  --el-tag-bg-color: rgb(41, 194, 66);
}
.node-list-panel .el-card .card-header:deep(.el-tag--danger) {
  --el-tag-bg-color: rgb(234, 104, 104);
}
.node-list-panel .el-card .card-header:deep(.el-tag--warning) {
  --el-tag-bg-color: rgb(230, 193, 45);
}
.node-list-panel .el-card .card-header:deep(.el-tag--info) {
  --el-tag-bg-color: rgb(173, 177, 182);
}

/* å°¾éƒ¨å®¹å™¨æ ·å¼ */
.node-list-panel .el-card :deep(.el-card__footer) {
  width: auto;
  padding-right: 15px;
  height: auto; /* ç¡®ä¿å¡«æ»¡ footer åŒºåŸŸ */
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center; /* å‚ç›´å±…ä¸­ */
  border: none;
  transition: none;
}
.node-list-panel .el-card .card-footer .edit-icon-btn,
.node-list-panel .el-card .card-footer .delete-icon-btn {
  padding: 0px;
  margin-right: 0px;
  height: auto;
  width: auto;
  border: none;
}
.node-list-panel .el-card .card-footer .edit-icon-btn :deep(.el-icon) {
  font-size: 1.2em;
}
.node-list-panel .el-card .card-footer .delete-icon-btn :deep(.el-icon) {
  font-size: 1.2em;
  margin-bottom: 0.15em;
}
.node-list-panel .el-card .footer-display-actions {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}
.node-list-panel .el-card .footer-edit-actions {
  display: flex;
  justify-content: space-between; /* è®©ä¸¤ä¸ªæŒ‰é’®å‡åŒ€åˆ†å¼€ */
  align-items: center;
  width: 100%;
}
.node-list-panel .el-card .card-footer .start-stop-btn .start-stop-btn,
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--primary,
.node-list-panel .el-card .card-footer .start-stop-btn .footer-edit-actions .el-button {
  border-radius: 16px;
  transition: all 0.2s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
  height: 32px;
  width: 64px;
  font-size: 100%;
  margin-left: 10px;
}
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--primary,
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--primary:focus {
  border-color: #409eff;
  background-color: #409eff;
  color: #ffffff;
}
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--primary:hover {
  transform: scale(1.02);
  box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
}
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--danger,
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--danger:focus {
  border-color: #f56c6c;
  background-color: #f56c6c;
  color: #ffffff;
}
.node-list-panel .el-card .card-footer .start-stop-btn .el-button--danger:hover {
  transform: scale(1.02);
  box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
}
.add-new-card.is-disabled {
  cursor: not-allowed;
  background-color: #f5f7fa;
  border-color: #e4e7ed;
}

/* å†…å®¹éƒ¨å®¹å™¨æ ·å¼ */
.node-list-panel .el-card :deep(.el-card__body) {
  font-size: 2vh;
  flex-grow: 1;
  width: 10%;
  padding: 10px 5px; /* è°ƒæ•´å†…è¾¹è· */
  transition: none;
}
.card-body-content {
  color: rgb(173, 177, 182);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: space-between; /* è®© launch path å’Œ edit icon ä¸¤ç«¯å¯¹é½ */
  align-items: center;
  word-break: break-all;
  margin-left: 0.5vw;
}
/* 4. launch æ–‡ä»¶è·¯å¾„æŒ‰é’®çš„æ ·å¼ */
.launch-path-button {
  font-size: 2vh;
  width: 100%;
  padding: 8px 8px 8px 8px;
  border-radius: 8px;
  justify-content: flex-start; /* è®©æŒ‰é’®å†…æ–‡å­—å·¦å¯¹é½ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* è¶…é•¿æ—¶æ˜¾ç¤ºçœç•¥å· */
  word-break: break-all;
}
/* ç¼–è¾‘æ¨¡å¼ä¸‹çš„è¡Œå¸ƒå±€ */
.launch-edit-row {
  display: flex;
  gap: 5px;
  width: 100%;
}
.launch-path-button {
  flex-grow: 1;
  /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
  justify-content: flex-start;
  overflow: hidden;
  text-overflow: ellipsis;
}
.launch-content-edit-btn {
  flex-shrink: 0;
  width: 32px;
  padding: 0;
}

/* ------ å³ä¾§åŠŸèƒ½å®¹å™¨æ ·å¼ ------ */
.el-main.function-panel {
  padding: 0;
  width: auto;
  height: 100%;
  margin-left: 0.5%;
}
.el-main.function-panel .auto-start-panel {
  width: auto;
  height: 60%;
  border: 2px dashed #e4e7ed;
  padding: 1% 1% 1% 1%;
  margin-bottom: 0.5%;
}
.el-main.function-panel .rosbag-panel {
  width: auto;
  height: auto;
  flex-grow: 1;
  border: 2px dashed #e4e7ed;
  padding: 1% 1% 1% 1%;
}
.rosbag-panel {
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
  margin-top: 15px;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.panel-header h2 {
  margin: 0;
  font-size: 16px;
  color: #303133;
}

.record-btn {
  width: 100%;
  margin-top: 10px;
  height: 40px;
  font-size: 16px;
}

.dot-blink {
  animation: blink 1s infinite;
  margin-right: 4px;
}

@keyframes blink {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
</style>

<style>
.el-overlay-dialog:has(.file-browser-dialog) {
  overflow: hidden !important;
  display: flex; /* é…åˆä¸‹é¢çš„ margin auto ä¿è¯å±…ä¸­ */
  align-items: center;
  justify-content: center;
}

.file-browser-dialog {
  margin: 0 !important;
  padding: 12px;
  display: flex;
  flex-direction: column;
  height: 75vh; /* å›ºå®šé«˜åº¦ï¼Œæˆ–è€… max-height: 90vh */
  width: 75vw;
  border-radius: 8px; /* åœ†è§’æ›´ç¾è§‚ */
  overflow: hidden; /* é˜²æ­¢åœ†è§’è¢«å†…éƒ¨å†…å®¹æº¢å‡ºé®æŒ¡ */
}

/* éšè— Element Plus åŸç”Ÿ Header */
.file-browser-dialog .el-dialog__header {
  display: none;
}

.file-browser-dialog .el-dialog__body {
  flex: 1;
  overflow: hidden;
  padding: 0 !important; /* ç§»é™¤å†…è¾¹è·ï¼Œç”±å†…éƒ¨ç»„ä»¶æ§åˆ¶ */
  border: 1px solid var(--el-border-color-light) !important;
  height: 100%;
}

/* è‡ªåŠ¨å¯åŠ¨é¢æ¿å¸ƒå±€ */
.auto-start-panel {
  flex: 1; /* å æ®ä¸€åŠé«˜åº¦ (å¦‚æœæœ‰ä¸¤ä¸ªpanelçš„è¯) */
  display: flex;
  flex-direction: column;
  background: #fff;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
.panel-header h2 {
  margin: 0;
  font-size: 16px;
  color: #303133;
}

/* åºåˆ—åˆ—è¡¨é¡¹ */
.seq-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #f0f2f5;
  transition: background 0.2s;
}
.seq-item:last-child {
  border-bottom: none;
}
.seq-item:hover {
  background-color: #fafafa;
}

.seq-name {
  font-size: 14px;
  font-weight: 500;
  color: #606266;
}
.seq-desc {
  font-size: 12px;
  color: #909399;
}

.empty-hint {
  text-align: center;
  color: #909399;
  padding: 20px;
  font-size: 13px;
}

/* å¼¹çª—å†…çš„ Timeline æ ·å¼ */
.timeline-editor {
  max-height: 300px;
  overflow-y: auto;
  padding-top: 10px;
}
.step-content {
  display: flex;
  align-items: center;
  gap: 10px;
}
.delay-input {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 13px;
  color: #606266;
}
/* å»æ‰ timeline æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ tail */
:deep(.el-timeline-item:last-child .el-timeline-item__tail) {
  display: none;
}
</style>


--- File: src/renderer/src/views/EditorView.vue ---
<template>
  <div class="ide-layout" tabindex="0" @keydown.ctrl.s.prevent="handleSave">
    <!-- 1. å·¦ä¾§ä¾§è¾¹æ ï¼šä¼šè¯åˆ—è¡¨ -->
    <aside class="sidebar">
      <div class="sidebar-title">æ–‡æœ¬ç¼–è¾‘å™¨</div>
      <div class="session-list">
        <div
          v-for="session in sessions"
          :key="session.id"
          class="session-item"
          :class="{ active: activeSessionId === session.id }"
          @click="activeSessionId = session.id"
        >
          <div class="session-info">
            <el-icon class="icon" :class="getSessionStatus(session.id)"><Monitor /></el-icon>
            <span class="label" :title="session.label">{{ session.label }}</span>
          </div>
          <el-icon class="close-btn" @click.stop="removeSessionTab(session.id)"><Close /></el-icon>
        </div>

        <!-- æ·»åŠ ä¼šè¯ç»„ -->
        <div class="add-session-group">
          <!-- è§¦å‘å™¨ Tab -->
          <div
            class="session-item add-trigger"
            :class="{ 'is-open': isAddMenuOpen }"
            @click="isAddMenuOpen = !isAddMenuOpen"
          >
            <div class="session-info">
              <el-icon class="icon"><Plus /></el-icon>
              <span class="label">æ·»åŠ ä¼šè¯...</span>
            </div>
            <el-icon class="arrow-icon" :class="{ rotated: isAddMenuOpen }"><ArrowRight /></el-icon>
          </div>

          <!-- ä¸‹æ‹‰èœå•å†…å®¹ -->
          <div v-show="isAddMenuOpen" class="add-dropdown">
            <!-- æƒ…å†µ 1: æœ‰å¯æ·»åŠ çš„åç«¯ -->
            <template v-if="availableBackendsToAdd.length > 0">
              <div
                v-for="item in availableBackendsToAdd"
                :key="item.settings.id"
                class="dropdown-item"
                @click="handleAddSession(item.settings.id)"
              >
                <span class="dot" :class="getSessionStatus(item.settings.id)"></span>
                <span class="label" :title="item.settings.ip">
                  {{ item.name || item.settings.ip }}
                </span>
                <el-icon class="add-icon"><Plus /></el-icon>
              </div>
            </template>

            <!-- æƒ…å†µ 2: æ‰€æœ‰åç«¯éƒ½å·²æ·»åŠ  -->
            <div v-else-if="savedBackendsConfig.length > 0" class="dropdown-info">
              <el-icon><Check /></el-icon>
              <span>æ‰€æœ‰ä¼šè¯å·²æ·»åŠ </span>
            </div>

            <!-- æƒ…å†µ 3: æ²¡æœ‰ä»»ä½•åç«¯é…ç½® -->
            <div v-else class="dropdown-info warning">
              <el-icon><Warning /></el-icon>
              <span>æœªæ‰¾åˆ°è¿æ¥é…ç½®</span>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- 2. å³ä¾§ä¸»åŒºåŸŸï¼šæ–‡ä»¶ç¼–è¾‘ -->
    <main class="main-area">
      <!-- æƒ…å†µ A: æœ‰é€‰ä¸­çš„ä¼šè¯ -->
      <div v-if="currentSession" class="editor-workspace">
        <!-- [å…³é”®ä¿®å¤] åªæœ‰çŠ¶æ€ä¸¥æ ¼ä¸º 'ready' æ—¶æ‰æ˜¾ç¤ºç¼–è¾‘å™¨ï¼Œå…¶ä»–çŠ¶æ€(failed/setting_up/disconnected)å…¨éƒ¨æ˜¾ç¤ºç¦»çº¿é¡µ -->
        <template v-if="getSessionStatus(currentSession.id) === 'ready'">
          <div class="tabs-wrapper" @wheel="handleTabsWheel">
            <el-tabs
              ref="tabsRef"
              v-model="currentSession.activeFile"
              type="card"
              class="file-tabs"
              @tab-remove="(path) => removeFileTab(currentSession, path)"
            >
              <!-- 1. å·²æ‰“å¼€çš„æ–‡ä»¶ -->
              <el-tab-pane
                v-for="file in currentSession.files"
                :key="file.path"
                :name="file.path"
                closable
              >
                <template #label>
                  <span class="tab-label-content" :class="{ 'dirty-file': file.isDirty }">
                    {{ file.name }}{{ file.isDirty ? ' â—' : '' }}
                  </span>
                </template>

                <div v-loading="file.loading" class="monaco-container">
                  <vue-monaco-editor
                    v-model:value="file.content"
                    :language="file.language"
                    theme="vs"
                    :options="monacoOptions"
                    class="monaco-editor-instance"
                    @change="file.isDirty = file.content !== file.originalContent"
                  />
                </div>
              </el-tab-pane>

              <!-- 2. æ·»åŠ é¡µç­¾ (æ–‡ä»¶æµè§ˆå™¨) -->
              <el-tab-pane name="__add_tab__" :closable="false">
                <template #label>
                  <span class="add-tab-btn">
                    <el-icon><Plus /></el-icon>
                  </span>
                </template>

                <div class="embedded-browser-wrapper">
                  <FileBrowser
                    :backend-id="currentSession.id"
                    :initial-path="'/'"
                    :show-close="false"
                    @file-selected="(path) => handleEmbeddedFileSelect(currentSession, path)"
                  />
                </div>
              </el-tab-pane>
            </el-tabs>
          </div>
        </template>

        <!-- ç¦»çº¿/è¿æ¥ä¸­/å¤±è´¥ çŠ¶æ€ -->
        <div v-else class="empty-state offline-state">
          <!-- æ ¹æ®å…·ä½“çŠ¶æ€æ˜¾ç¤ºä¸åŒå›¾æ ‡ -->
          <template v-if="getSessionStatus(currentSession.id) === 'setting_up'">
            <el-icon :size="50" class="is-loading" color="#E6A23C"><Loading /></el-icon>
            <h3>æ­£åœ¨è¿æ¥...</h3>
            <p>æ­£åœ¨å°è¯•è¿æ¥åç«¯ {{ currentSession.label }}</p>
          </template>

          <template v-else>
            <el-icon :size="50" color="#f56c6c"><Connection /></el-icon>
            <h3>è¿æ¥ä¸å¯ç”¨</h3>
            <p>
              æ— æ³•è¿æ¥åˆ°åç«¯ {{ currentSession.label }} ({{ getSessionStatus(currentSession.id) }})
            </p>
            <el-button
              type="primary"
              :icon="RefreshRight"
              style="margin-top: 20px"
              @click="retryConnection"
            >
              é‡è¯•è¿æ¥
            </el-button>
          </template>
        </div>
      </div>

      <!-- æƒ…å†µ B: æ²¡æœ‰é€‰æ‹©ä¼šè¯ -->
      <div v-else class="empty-state">
        <div class="empty-content">
          <p>è¯·åœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªä¼šè¯</p>
        </div>
      </div>

      <!-- åº•éƒ¨çŠ¶æ€æ  -->
      <div class="status-bar">
        <div class="left">
          <span v-if="currentSession && currentSession.activeFile === '__add_tab__'">
            {{ currentSession.label }} &nbsp;>&nbsp; æ–‡ä»¶æµè§ˆå™¨
          </span>
          <span v-else-if="currentSession && currentFile">
            {{ currentSession.label }} &nbsp;>&nbsp; {{ currentFile.path }}
          </span>
        </div>
        <div class="right">
          <el-dropdown
            v-if="currentFile"
            trigger="hover"
            placement="top"
            @command="handleLanguageChange"
          >
            <span class="language-selector">
              {{ getLanguageLabel(currentFile.language) }}
            </span>
            <template #dropdown>
              <el-dropdown-menu class="lang-dropdown">
                <el-dropdown-item
                  v-for="opt in languageOptions"
                  :key="opt.id"
                  :command="opt.id"
                  :class="{ 'is-selected': opt.id === currentFile.language }"
                >
                  {{ opt.label }}
                </el-dropdown-item>
              </el-dropdown-menu>
            </template>
          </el-dropdown>
          <span v-if="currentFile?.isDirty" class="dirty-badge">æœªä¿å­˜</span>
        </div>
      </div>
    </main>

    <el-dialog v-model="isFileBrowserVisible" title="æ‰“å¼€æ–‡ä»¶" width="70%" destroy-on-close>
      <!-- 
        currentSession å­˜åœ¨æ—¶æ‰æ¸²æŸ“ FileBrowser 
        backend-id: ä¼ å…¥å½“å‰ä¼šè¯çš„ IDï¼Œè¿™æ · FileBrowser å°±çŸ¥é“å»å“ªä¸ªåç«¯è¯»ç›®å½•
      -->
      <FileBrowser
        v-if="currentSession"
        :backend-id="currentSession.id"
        :initial-path="'/'"
        :show-close="false"
        :hide-footer="true"
        @file-selected="handleFileBrowserSelection"
        @cancel="isFileBrowserVisible = false"
      />
    </el-dialog>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.ide-layout {
  --bg-color: #ffffff;
  --sidebar-bg: #f5f7fa; /* æµ…ç°èƒŒæ™¯ */
  --sidebar-hover: #e6e8eb;
  --sidebar-active: #ffffff;
  --border-color: #dcdfe6;
  --text-primary: #303133;
  --text-secondary: #909399;
  --primary-color: #409eff;
  --header-height: 35px; /* ä¸ main process ä¸­å®šä¹‰çš„ overlay é«˜åº¦ä¸€è‡´ */

  display: flex;
  height: 100vh;
  width: 100vw;
  background-color: var(--bg-color);
  color: var(--text-primary);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  overflow: hidden;
}

/* --- å·¦ä¾§ä¾§è¾¹æ  --- */
.sidebar {
  width: 220px;
  flex-shrink: 0;
  background-color: var(--sidebar-bg);
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border-color);
  height: 100%;
}

.sidebar-title {
  height: var(--header-height); /* å›ºå®šé«˜åº¦ */
  display: flex;
  align-items: center;
  padding-left: 15px;
  font-size: 12px;
  text-transform: uppercase;
  font-weight: bold;
  color: var(--text-secondary);
  letter-spacing: 0.5px;

  /* å…³é”®ï¼šè®¾ç½®ä¸ºæ‹–æ‹½åŒºåŸŸ */
  -webkit-app-region: drag;
  user-select: none;
}

.session-list {
  flex-grow: 1;
  overflow-y: auto;
  padding-top: 5px;
}

.session-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 15px;
  cursor: pointer;
  font-size: 13px;
  border-left: 3px solid transparent;
  transition: background 0.2s;
  color: var(--text-primary);

  /* åˆ—è¡¨é¡¹ä¸å¯æ‹–æ‹½ï¼Œå¦åˆ™æ— æ³•ç‚¹å‡» */
  -webkit-app-region: no-drag;
}

.session-item:hover {
  background-color: var(--sidebar-hover);
}
.session-item.active {
  background-color: var(--sidebar-active);
  color: var(--primary-color);
  border-left-color: var(--primary-color);
  font-weight: 500;
}

.session-info {
  display: flex;
  align-items: center;
  overflow: hidden;
}
.session-info .icon {
  margin-right: 8px;
  font-size: 16px;
}
.session-info .label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.close-btn {
  opacity: 0;
  font-size: 14px;
  padding: 2px;
  border-radius: 3px;
  color: var(--text-secondary);
}
.session-item:hover .close-btn {
  opacity: 1;
}
.close-btn:hover {
  background-color: #dedfe0;
  color: #f56c6c;
}
.add-session-group {
  border-top: 1px solid var(--border-color);
  margin-top: 5px;
}

.add-trigger {
  color: var(--text-secondary);
}

.add-trigger:hover {
  color: var(--primary-color);
  background-color: var(--sidebar-hover);
}

.arrow-icon {
  font-size: 12px;
  transition: transform 0.2s;
}
.arrow-icon.rotated {
  transform: rotate(90deg);
}
/* çŠ¶æ€é¢œè‰²æ˜ å°„ (ä¸ MainView ä¿æŒä¸€è‡´) */
.session-info .el-icon.ready {
  color: #409eff;
}
.session-info .el-icon.setting_up {
  color: #e6a23c;
}
.session-info .el-icon.failed {
  color: #f56c6c;
}
.session-info .el-icon.disconnected {
  color: #909399;
}

/* ä¸‹æ‹‰èœå•å®¹å™¨ */
.add-dropdown {
  background-color: #eaecf0; /* æ¯”ä¾§è¾¹æ ç¨æ·±ä¸€ç‚¹ï¼Œä½“ç°å±‚çº§ */
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
  padding: 5px 0;
}
.dropdown-item {
  display: flex;
  align-items: center;
  padding: 6px 15px 6px 25px; /* å¢åŠ å·¦å†…è¾¹è·ä½“ç°ç¼©è¿› */
  cursor: pointer;
  font-size: 12px;
  color: var(--text-primary);
  transition: background 0.2s;
}
.dropdown-item:hover {
  background-color: #dcdfe6;
}
.dropdown-item .label {
  flex-grow: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-right: 10px;
}
.dropdown-item .dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  margin-right: 8px;
  background-color: #67c23a; /* ç»¿è‰²è¡¨ç¤ºåœ¨çº¿ */
}
.dropdown-item .add-icon {
  font-size: 14px;
  color: var(--text-secondary);
}
.dropdown-item:hover .add-icon {
  color: var(--primary-color);
}
.dropdown-item .dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  margin-right: 8px;
  background-color: #dcdfe6; /* é»˜è®¤æœªçŸ¥ */
}
.dropdown-item .dot.ready {
  background-color: #409eff;
}

/* ä¿¡æ¯æç¤ºæ ·å¼ */
.dropdown-info {
  padding: 10px 15px 10px 25px;
  font-size: 12px;
  color: #909399;
  display: flex;
  align-items: center;
  gap: 8px;
}
.dropdown-info.warning {
  color: #e6a23c;
}
/* --- å³ä¾§ä¸»åŒºåŸŸ --- */
.main-area {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  background-color: var(--bg-color);
  height: 100%;
  min-width: 0;
}
.editor-workspace {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
  position: relative;
}

/* --- Tabs åŒºåŸŸ --- */
.tabs-wrapper {
  height: 100%;
  width: 100%;
  display: flex; /* ä½¿ç”¨ flex å¸ƒå±€ */
  flex-direction: column;
}
.file-tabs {
  background-color: var(--sidebar-bg); /* é¡¶éƒ¨èƒŒæ™¯ç»Ÿä¸€ä¸ºæµ…ç° */
  height: 100%;
  display: flex;
  flex-direction: column;
}
:deep(.el-tabs--card > .el-tabs__header) {
  height: auto;
}
:deep(.el-tabs__header) {
  height: auto;
  margin: 0;
  background-color: var(--sidebar-bg);
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
  /* å…³é”®ï¼šTabs å¤´éƒ¨ç©ºç™½å¤„å¯ä»¥æ‹–æ‹½ */
  -webkit-app-region: drag;
  /* ä¸ºå³ä¾§çš„ Window Controls ç•™å‡ºç©ºé—´ (Electron Overlay åœ¨ Windows ä¸Šçº¦ 130px) */
  padding-right: 140px;
}

/* å•ä¸ª Tab é¡¹ */
:deep(.el-tabs__item) {
  height: var(--header-height);
  line-height: var(--header-height);
  border-radius: 0 !important;
  border-top: none !important;
  border-left: none !important; /* å»é™¤é»˜è®¤è¾¹æ¡†ï¼Œæ›´ç°ä»£ */
  border-right: 1px solid var(--border-color) !important;
  font-size: 13px;
  color: var(--text-secondary);
  /* Tab æœ¬èº«ä¸å¯æ‹–æ‹½ï¼Œå¦åˆ™æ— æ³•ç‚¹å‡» */
  -webkit-app-region: no-drag;
}
/* --- ä¿®å¤ Tab åŠ å·æŒ‰é’® --- */
:deep(.el-tabs__new-tab) {
  -webkit-app-region: no-drag !important;
  margin-right: 10px;
  cursor: pointer;
}

/* åµŒå…¥å¼æ–‡ä»¶æµè§ˆå™¨çš„å®¹å™¨æ ·å¼ */
.embedded-browser-wrapper {
  height: 100%;
  width: 100%;
  display: flex;
  flex-grow: 1;
}

:deep(.el-tabs__item.is-active) {
  background-color: #ffffff; /* æ¿€æ´»å˜ä¸ºç™½è‰²ï¼Œä¸ä¸‹æ–¹ç¼–è¾‘å™¨èä¸ºä¸€ä½“ */
  border-bottom-color: transparent !important;
  color: var(--primary-color);
  font-weight: 500;
}
:deep(.el-tabs__nav) {
  border: none !important;
}

:deep(.el-tabs__content) {
  padding: 0;
  flex-grow: 1;
  height: 0;
  background-color: #ffffff;
}

:deep(.el-tab-pane) {
  display: flex;
  height: 100%;
  width: 100%;
}

/* --- Monaco å®¹å™¨ --- */
.monaco-container {
  height: 100%;
  width: 100%;
  background-color: #ffffff; /* æµ…è‰²èƒŒæ™¯ */
  position: relative;
  overflow: hidden;
}

.monaco-editor-instance {
  height: 100%;
  width: 100%;
}

.empty-state {
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #ffffff;
  color: var(--text-secondary);
}

.dirty-file {
  color: #e6a23c;
}

/* --- åº•éƒ¨çŠ¶æ€æ  --- */
.status-bar {
  height: 24px;
  background-color: var(--primary-color); /* ä½¿ç”¨ Element Plus è“è‰² */
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 10px;
  font-size: 12px;
  flex-shrink: 0;
  user-select: none;
}
.right {
  display: flex;
  gap: 15px;
}
.dirty-badge {
  font-weight: bold;
  background-color: rgba(255, 255, 255, 0.2);
  padding: 0 4px;
  border-radius: 2px;
}
.language-selector {
  cursor: pointer;
  padding: 2px 6px;
  border-radius: 0px;
  transition: background-color 0.2s;
  color: white; /* ç»§æ‰¿çŠ¶æ€æ æ–‡å­—é¢œè‰² */
  font-weight: 500;
  outline: none !important;
  user-select: none;
}
.language-selector:hover {
  background-color: rgba(255, 255, 255, 0.2);
}
/* ä¸‹æ‹‰èœå•é€‰ä¸­é¡¹é«˜äº® (éœ€è¦ç”¨ :global æˆ–è€…æ”¾åˆ°é scoped æ ·å¼ä¸­ï¼Œå› ä¸º dropdown æ˜¯æŒ‚è½½åœ¨ body ä¸Šçš„) */
/* ä½†å¦‚æœæ˜¯ scopedï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ·±åº¦é€‰æ‹©å™¨ï¼Œæˆ–è€… Element Plus è‡ªå¸¦ active class */
.lang-dropdown .el-dropdown-menu__item.is-selected {
  color: var(--primary-color);
  background-color: #ecf5ff;
  font-weight: bold;
}
/* é™åˆ¶ä¸‹æ‹‰èœå•é«˜åº¦ï¼Œé˜²æ­¢å¤ªé•¿ */
.lang-dropdown {
  max-height: 300px;
  overflow-y: auto;
}
</style>


--- File: src/renderer/src/views/LogManager.vue ---
<template>
  <div class="log-manager-root">
    <!-- æƒ…å†µ1: æ²¡æœ‰ä»»ä½•è¿æ¥ -->
    <el-empty v-if="clientKeys.length === 0" description="è¯·å…ˆè¿æ¥æœºå™¨äºº" />

    <!-- æƒ…å†µ2: æœ‰è¿æ¥ï¼Œæ˜¾ç¤ºä¸€çº§ Tabs (æœºå™¨äººåˆ—è¡¨) -->
    <el-tabs v-else v-model="activeRobotTab" type="border-card" class="level-1-tabs">
      <el-tab-pane v-for="key in clientKeys" :key="key" :name="key">
        <template #label>
          <span class="robot-tab-label">
            <el-icon><Connection /></el-icon>
            {{ getClientName(key) }}
          </span>
        </template>

        <!-- åµŒå…¥äºŒçº§ Tab ç»„ä»¶ -->
        <!-- ä½¿ç”¨ keep-alive ä¿æŒç»ˆç«¯è¿æ¥å’Œæ—¥å¿—çŠ¶æ€ -->
        <LogPanel :backend-id="key" />
      </el-tab-pane>
    </el-tabs>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.log-manager-root {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.level-1-tabs {
  height: 100%;
  display: flex;
  flex-direction: column;
  border: none;
}
:deep(.el-tabs__content) {
  flex: 1;
  padding: 0;
  /* è¿™é‡Œçš„ padding 0 å¾ˆé‡è¦ï¼Œè®©äºŒçº§ Tab è´´è¾¹ */
}
:deep(.el-tab-pane) {
  height: 100%;
}
.robot-tab-label {
  display: flex;
  align-items: center;
  gap: 5px;
}
</style>


--- File: src/renderer/src/views/MainView.vue ---
<template>
  <el-container class="app-container">
    <el-header class="app-title-header">
      <div class="info-left">
        <img :src="logoURL" alt="App Logo" class="header-logo" />
        <h1>ROS Ground Control</h1>
      </div>
      <div class="button-right">
        <el-divider direction="vertical" :class="{ 'is-inactive': !isWindowFocused }" />
        <el-button
          type="primary"
          circle
          :class="{ 'is-inactive': !isWindowFocused }"
          @click="openEditorWindow"
        >
          <el-icon :size="16"> <EditPen /> </el-icon>
        </el-button>
        <el-divider direction="vertical" :class="{ 'is-inactive': !isWindowFocused }" />
        <el-button
          type="primary"
          circle
          :class="{ 'is-inactive': !isWindowFocused }"
          :disabled="isConnected"
          @click="showSettings = true"
        >
          <el-icon :size="16"> <Tools /> </el-icon>
        </el-button>
        <el-divider direction="vertical" :class="{ 'is-inactive': !isWindowFocused }" />
        <el-button
          type="primary"
          circle
          :class="{ 'is-inactive': !isWindowFocused }"
          :disabled="isConnected"
          @click="dialogVisible = true"
        >
          <el-icon :size="16"> <InfoFilled /> </el-icon>
        </el-button>
        <el-divider direction="vertical" :class="{ 'is-inactive': !isWindowFocused }" />
      </div>
    </el-header>
    <el-main>
      <el-tabs v-model="activeTab" type="border-card" tab-position="left" class="main-tabs">
        <el-tab-pane name="dashboard">
          <template #label>
            <div class="tabs-title">
              <el-icon :size="24"> <Grid /> </el-icon>
              <span class="vertical-tab-label">èŠ‚ç‚¹æ§åˆ¶</span>
            </div>
          </template>
          <Dashboard
            :current-backend-id="currentBackendId"
            :is-current-backend-ready="isCurrentBackendReady"
          />
        </el-tab-pane>
        <el-tab-pane name="monitor">
          <template #label>
            <div class="tabs-title">
              <el-icon :size="24"> <Monitor /> </el-icon>
              <span class="vertical-tab-label">è¯é¢˜ç›‘æ§</span>
            </div>
          </template>
          <TopicMonitor
            :current-backend-id="currentBackendId"
            :is-current-backend-ready="isCurrentBackendReady"
          />
        </el-tab-pane>
        <el-tab-pane name="logs">
          <template #label>
            <div class="tabs-title">
              <el-icon :size="24"> <DataBoard /> </el-icon>
              <span class="vertical-tab-label">ç»ˆç«¯æ—¥å¿—</span>
            </div>
          </template>
          <LogManager :current-backend-id="currentBackendId" />
        </el-tab-pane>
      </el-tabs>
    </el-main>

    <el-footer class="app-footer">
      <div class="footer-left-controls">
        <div class="connection-config">
          <!-- ä½¿ç”¨ Popover å®ç°å‘ä¸Šå±•å¼€çš„åˆ—è¡¨ -->
          <el-popover
            v-model:visible="isPopoverVisible"
            placement="top-start"
            :width="280"
            trigger="hover"
            :show-after="50"
            :hide-after="50"
            popper-class="backend-list-popover"
          >
            <template #reference>
              <div class="popover-trigger-wrapper">
                <el-button
                  class="connection-status-button"
                  :type="backendStatusProps.type"
                  :icon="backendStatusProps.icon"
                  :style="{
                    '--el-button-text-color': backendStatusProps.color,
                    '--el-button-disabled-text-color': backendStatusProps.color
                  }"
                  :loading="
                    currentBackendStatus === 'setting_up' || currentBackendStatus === 'tearing_down'
                  "
                  round
                  text
                  @click="handleConfigButtonClick"
                >
                  <!-- æ˜¾ç¤ºæ–‡æœ¬é€»è¾‘ï¼šå¦‚æœæ˜¯ Local ä¸”æ²¡åå­—ï¼Œæ˜¾ç¤º Localï¼›å¦åˆ™æ˜¾ç¤ºåå­—æˆ– User@Host -->
                  <span class="connection-btn-contain">{{ backendStatusProps.text }}</span>
                </el-button>
              </div>
            </template>

            <!-- å¼¹å‡ºå±‚å†…å®¹ï¼šè¿æ¥åˆ—è¡¨ -->
            <div class="backend-list-container">
              <div class="backend-list-header">å¯ç”¨è¿æ¥</div>
              <el-scrollbar max-height="300px">
                <div
                  v-for="(item, index) in savedBackends"
                  :key="index"
                  class="backend-item"
                  :class="{ 'is-active': isActiveBackend(item), 'is-disabled': isAnyLoading }"
                  @click="switchToBackend(item)"
                >
                  <div class="status-dot-container">
                    <!-- ä½¿ç”¨åŠ¨æ€ class ç»‘å®šé¢œè‰² -->
                    <div class="list-status-dot" :class="getItemStatus(item)"></div>
                  </div>
                  <div class="backend-info">
                    <div class="backend-name">{{ getBackendDisplayName(item) }}</div>
                    <div class="backend-detail">
                      {{ item.settings.mode === 'local' ? 'Localhost' : item.settings.ip }}
                    </div>
                  </div>
                  <!-- æ‚¬æµ®æ“ä½œæŒ‰é’® -->
                  <div class="backend-actions" @click.stop>
                    <!-- å¦‚æœæœªè¿è¡Œï¼Œæ˜¾ç¤ºâ€œåˆ é™¤â€æŒ‰é’® -->
                    <el-button
                      v-if="!isBackendRunning(item) && !isDefaultLocalBackend(item)"
                      circle
                      type="danger"
                      link
                      title="åˆ é™¤è¿æ¥"
                      @click="deleteBackend(index)"
                    >
                      <el-icon><Delete /></el-icon>
                    </el-button>
                    <!-- å¦‚æœå·²è¿æ¥ï¼Œæ˜¾ç¤ºâ€œæ–­å¼€â€æŒ‰é’® -->
                    <el-button
                      v-if="getItemStatus(item) === 'ready'"
                      circle
                      type="danger"
                      link
                      title="æ–­å¼€è¿æ¥"
                      @click="handleManualDisconnect(item)"
                    >
                      <el-icon><SwitchButton /></el-icon>
                    </el-button>
                    <!-- å¦‚æœæœªè¿è¡Œï¼Œæ˜¾ç¤ºâ€œç¼–è¾‘â€æŒ‰é’® -->
                    <el-button
                      v-if="!isBackendRunning(item) && !isDefaultLocalBackend(item)"
                      circle
                      type="primary"
                      link
                      title="ç¼–è¾‘è¿æ¥"
                      @click="openEditDialog(index, item)"
                    >
                      <el-icon><Edit /></el-icon>
                    </el-button>
                  </div>
                  <!-- é€‰ä¸­æ ‡è®° -->
                  <div v-if="isActiveBackend(item)" class="active-check">
                    <el-icon><Check /></el-icon>
                  </div>
                </div>
              </el-scrollbar>

              <el-divider style="margin: 8px 0" />

              <!-- æ·»åŠ æ–°è¿æ¥æŒ‰é’® -->
              <div
                class="add-buttons-wrapper"
                @mouseenter="handleAddHover(true)"
                @mouseleave="handleAddHover(false)"
              >
                <transition-group
                  name="btn-slide"
                  tag="div"
                  class="add-buttons-container"
                  :class="{ 'is-hovered': isHoveringAdd }"
                >
                  <!-- 1. åŸæœ‰çš„â€œæ·»åŠ æ–°è¿æ¥â€æŒ‰é’® -->
                  <!-- key æ˜¯ transition-group å¿…éœ€çš„ -->
                  <div key="add-new" class="add-backend-btn" @click.stop="openAddDialog">
                    <el-icon><Plus /></el-icon>
                    <span>æ·»åŠ æ–°è¿æ¥</span>
                  </div>
                  <!-- 2. æ–°å¢çš„â€œé¦–æ¬¡éƒ¨ç½²â€æŒ‰é’® -->
                  <div
                    v-if="showFirstTimeSetupButton"
                    key="first-setup"
                    class="add-backend-btn primary-style"
                    @click.stop="openFirstTimeSetupDialog"
                  >
                    <el-icon><MagicStick /></el-icon>
                    <span>é¦–æ¬¡è¿æ¥</span>
                  </div>
                </transition-group>
              </div>
            </div>
          </el-popover>
        </div>

        <div class="connect-toggle-button">
          <el-button
            :type="isConnected ? 'danger' : 'success'"
            :loading="isActionInProgress"
            :disabled="!isCurrentBackendReady"
            round
            plain
            @click="toggleServiceConnection"
          >
            {{ connectionButtonText }}
          </el-button>
        </div>
      </div>

      <div class="status-indicators">
        <div class="status-item">
          <span>Roscore:</span>
          <el-tag :type="roscoreProps.type" effect="dark" size="small" round>
            <span class="dot" :class="roscoreStatus"></span>
            {{ roscoreProps.text }}
          </el-tag>
        </div>
        <div class="status-item">
          <span>Rosbridge:</span>
          <el-tag :type="rosbridgeProps.type" effect="dark" size="small" round>
            <span class="dot" :class="rosbridgeStatus"></span>
            {{ rosbridgeProps.text }}
          </el-tag>
        </div>
      </div>
    </el-footer>
  </el-container>
  <ConnectionDialog
    v-model:visible="dialogVisible"
    :initial-data="dialogInitialData"
    @apply="handleConnectionApply"
  />
  <SettingsDialog
    v-model="showSettings"
    v-model:settings="appSettings"
    @reset-config="handleAppReset"
  />
  <FirstTimeSetupDialog
    v-model="isFirstTimeSetupDialogVisible"
    :is-deploying="isDeploying"
    @deploy="handleDeploy"
  />
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style>
@font-face {
  font-family: 'consola'; /* <-- ç»™ä½ çš„å­—ä½“èµ·ä¸€ä¸ªåœ¨CSSä¸­ä½¿ç”¨çš„åå­— */
  src: url('/fonts/consola.ttf') format('ttf'); /* <-- å¼•ç”¨ public ç›®å½•ä¸‹çš„å­—ä½“æ–‡ä»¶ */
  font-weight: normal; /* å®šä¹‰è¿™ä¸ªå­—ä½“æ–‡ä»¶å¯¹åº”çš„å­—é‡ */
  font-style: normal; /* å®šä¹‰è¿™ä¸ªå­—ä½“æ–‡ä»¶å¯¹åº”çš„æ ·å¼ */
}

/* 2. åº”ç”¨æ ¹å®¹å™¨ï¼šä½¿ç”¨ Flexbox å‚ç›´å¸ƒå±€ */
.app-container {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.app-container .el-main {
  height: auto;
  width: auto;
  padding: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.el-header.app-title-header {
  height: 50px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #2c3e50; /* ä¸€ä¸ªæ·±è‰²çš„å¤´éƒ¨èƒŒæ™¯ */
  color: #ffffff; /* ç™½è‰²æ–‡å­— */
  -webkit-app-region: drag;
  padding-left: 20px;
  padding-right: 110px;
}
.app-title-header .info-left {
  display: flex;
  align-items: center; /* å‚ç›´å±…ä¸­ Logo å’Œæ ‡é¢˜ */
  gap: 20px; /* åœ¨ Logo å’Œæ ‡é¢˜ä¹‹é—´åˆ›å»ºä¸€äº›é—´è· */
  flex-direction: row;
  justify-content: center;
}
.app-title-header .header-logo {
  height: 1.2em; /* æ§åˆ¶ Logo çš„é«˜åº¦ï¼Œå®½åº¦ä¼šè‡ªåŠ¨ç¼©æ”¾ */
  width: auto;
  object-fit: contain; /* ç¡®ä¿å›¾ç‰‡åœ¨ä¿æŒæ¯”ä¾‹çš„åŒæ—¶å®Œæ•´æ˜¾ç¤º */
}
.app-title-header .button-right {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0px;
}
.app-title-header .button-right .el-divider.is-inactive {
  color: #ffffff;
}
.app-title-header .button-right .el-divider.is-inactive {
  color: #999999;
}
.app-title-header .button-right .el-button {
  background-color: #2c3e50;
  border: 0px solid #2c3e50;
  margin-left: -5px;
  margin-right: -5px;
  padding: 0px;
  transition: all 0.3s ease-out;
  -webkit-app-region: no-drag;
}
.app-title-header .button-right .el-button.is-inactive {
  color: #999999;
}
.app-title-header .button-right .el-button:hover {
  transform: scale(1.1);
}
.app-title-header .button-right .el-button:hover,
.app-title-header .button-right .el-button:focus {
  background-color: rgba(255, 255, 255, 0.1);
  border: 0px solid #2c3e50;
}
.app-title-header h1 {
  margin: 0; /* å»æ‰ h1 æ ‡ç­¾çš„é»˜è®¤è¾¹è· */
  font-size: 20px;
}

/* 3. Tabs ç»„ä»¶ï¼šè®©å®ƒå¼¹æ€§å¢é•¿ä»¥å¡«æ»¡å‰©ä½™ç©ºé—´ */
.main-tabs {
  flex-grow: 1;
  display: flex;
  flex-direction: row;
}
.main-tabs > .el-tabs__content {
  flex-grow: 1;
  padding: 5px;
}
.el-tabs--left.el-tabs--border-card .el-tabs__header.is-left {
  height: 100%;
  display: flex;
  margin: 0;
}
.el-tabs__nav.is-left {
  height: 100%;
  display: flex; /* <-- å…³é”®ï¼šå°†å…¶å˜ä¸º Flex å®¹å™¨ */
  flex-direction: column; /* è®© tab å‚ç›´æ’åˆ— */
}
.el-tabs__item.is-left {
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 20px;
  height: auto;
}
.tabs-title {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.8em;
}
.vertical-tab-label {
  font-size: 20px;
  writing-mode: vertical-lr; /* <-- å…³é”®ï¼šå¼€å¯å‚ç›´ä¹¦å†™æ¨¡å¼ */
  letter-spacing: 0.1em; /* (å¯é€‰) å¢åŠ å­—é—´è·ï¼Œè®©å‚ç›´æ–‡å­—æ›´å¥½çœ‹ */
  line-height: 1; /* (å¯é€‰) è°ƒæ•´è¡Œé«˜ï¼Œè®©æ–‡å­—æ›´ç´§å‡‘ */
  padding-right: 0.2em;
}

/* 5. ç¡®ä¿æ¯ä¸ª Tab Pane éƒ½æ˜¯å—çº§å¸ƒå±€å¹¶å æ»¡é«˜åº¦ */
.el-tabs--border-card {
  background: transparent;
  border: none;
}

.el-tab-pane {
  height: 100%;
  width: 100%;
}
.el-tabs__content {
  background-color: transparent;
  padding: 20px; /* å¢åŠ ä¸€äº›å†…è¾¹è·ï¼Œè®©å¡ç‰‡ä¸è´´è¾¹ */
}

/* 6. Footer æ ·å¼ */
.el-footer.app-footer {
  height: 50px;
  border-top: 1px solid #e4e7ed;
  background-color: #f5f7fa;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* å·¦ä¾§å’Œä¸­é—´æŒ‰é’®çš„å®¹å™¨ */
.footer-left-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* 1. é…ç½®æŒ‰é’®çš„æ ·å¼ */
.connection-config .connection-status-button {
  height: 30px;
  margin-left: -8px;
}
.connection-config .connection-status-button .connection-btn-contain {
  font-size: 16px;
}
/* è°ƒæ•´åŸæŒ‰é’®ï¼Œæ”¯æŒå›¾æ ‡å³å¯¹é½ */
.connection-status-button {
  padding-right: 8px !important; /* ç»™ç®­å¤´ç•™ç‚¹ç©ºé—´ */
}
/* Popover å†…éƒ¨å®¹å™¨ */
.connection-config .popover-trigger-wrapper {
  display: inline-block; /* ç¡®ä¿ wrapper åŒ…è£¹ä½æŒ‰é’®ä¸”ä¸ç‹¬å ä¸€è¡Œ */
  display: flex;
  transition: transform 0.2s ease-in-out;
}
.connection-config .popover-trigger-wrapper:hover {
  transform: scale(1.02);
}
.connection-config .popover-trigger-wrapper:active {
  transform: scale(0.98);
}
.backend-list-container {
  display: flex;
  flex-direction: column;
}
.backend-list-header {
  font-size: 12px;
  color: #909399;
  margin-bottom: 8px;
  padding-left: 4px;
}
/* å®¹å™¨ Wrapper */
/* å¢åŠ è¿™ä¸ª wrapper æ˜¯ä¸ºäº†ç²¾ç¡®æ§åˆ¶ hover åŒºåŸŸ */
.add-buttons-wrapper {
  padding: 5px 0; /* ç»™ä¸€ç‚¹å‚ç›´å†…è¾¹è· */
  min-height: 40px;
}
/* æŒ‰é’®å®¹å™¨ï¼Œç°åœ¨æ˜¯ transition-group çš„å­å…ƒç´  */
.add-buttons-container {
  display: flex;
  align-items: center;
  gap: 10px;
}
/* åŸå§‹â€œæ·»åŠ â€æŒ‰é’®æ ·å¼ (ä¿æŒä¸å˜) */
.add-backend-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 8px;
  cursor: pointer;
  color: #606266;
  font-size: 13px;
  border-radius: 4px;
  border: 1px dashed #dcdfe6;
  white-space: nowrap;
  box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šå½±å“å®½åº¦è®¡ç®— */
  white-space: nowrap;
  width: 100%;
  transition: all 0.3s ease;
}
.add-backend-btn:hover,
.add-backend-btn.primary-style:hover {
  border-color: #409eff;
  color: #409eff;
  background-color: #ecf5ff;
}
.add-buttons-container.is-hovered .add-backend-btn {
  width: calc(50% - 5px);
}

/* â€œé¦–æ¬¡éƒ¨ç½²â€æŒ‰é’®çš„ç‰¹æ®Šæ ·å¼ */
.add-backend-btn.primary-style {
  color: #606266;
  font-size: 13px;
  border-radius: 4px;
  border: 1px dashed #dcdfe6;
  white-space: nowrap;
  box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šå½±å“å®½åº¦è®¡ç®— */
  white-space: nowrap;
}
/* å®šä¹‰è¿›å…¥å’Œç¦»å¼€æ—¶çš„åŠ¨ç”» */
.btn-slide-enter-active {
  transition: all 0.3s ease;
  overflow: hidden;
}
.btn-slide-leave-active {
  right: 0;
  transition: all 0.3s ease;
  overflow: hidden;
}
/* è¿›å…¥å‰ å’Œ ç¦»å¼€å çš„çŠ¶æ€ */
.btn-slide-enter-from {
  opacity: 0;
  transform: scale(0.8);
  /* åˆå§‹å®½åº¦ä¸º0ï¼Œè®©å®ƒå¹³æ»‘åœ°â€œé•¿â€å‡ºæ¥ */
  width: 0;
  padding: 0;
  margin-left: 0 !important;
}
.btn-slide-leave-to {
  opacity: 0;
  transform: scale(0.8);
  /* ç›®æ ‡å®½åº¦ä¸º0ï¼Œè®©å®ƒå¹³æ»‘åœ°â€œç¼©â€å›å» */
  width: 0;
  padding: 0;
  margin-left: 0 !important;
}
.btn-slide-move {
  transition: transform 0.3s ease;
}

/* åˆ—è¡¨é¡¹æ ·å¼ */
.backend-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s;
  position: relative;
  margin-bottom: 4px;
}
.backend-item:hover {
  background-color: #f5f7fa;
}
.backend-item.is-active {
  background-color: #ecf5ff;
}
.backend-info {
  flex-grow: 1;
  overflow: hidden;
}
.backend-name {
  font-size: 14px;
  font-weight: 500;
  color: #303133;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.backend-detail {
  font-size: 12px;
  color: #909399;
}
.backend-item.is-disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
/* æ‚¬æµ®æŒ‰é’®åŒºåŸŸï¼šé»˜è®¤éšè—ï¼ŒHoveræ—¶æ˜¾ç¤º */
.backend-actions {
  display: none;
  align-items: center;
  gap: 4px;
}
.backend-item:hover .backend-actions {
  display: flex;
}
/* å½“æ˜¾ç¤ºæ“ä½œæŒ‰é’®æ—¶ï¼Œéšè—é€‰ä¸­æ ‡è®° */
.backend-item:hover .active-check {
  display: none;
}
.active-check {
  color: #409eff;
  font-weight: bold;
}

.status-dot-container {
  margin-right: 10px;
  display: flex;
  align-items: center;
}

.list-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #dcdfe6; /* é»˜è®¤ç°è‰² (disconnected) */
  transition: background-color 0.3s;
}

.list-status-dot.ready {
  background-color: #67c23a; /* ç»¿è‰² */
  box-shadow: 0 0 4px #67c23a;
}

.list-status-dot.setting_up {
  background-color: #e6a23c; /* é»„è‰² */
  animation: blink 1s infinite;
}

.list-status-dot.failed {
  background-color: #f56c6c; /* çº¢è‰² */
}

.connected-tag {
  font-size: 10px;
  color: #67c23a;
  margin-left: 4px;
}

@keyframes blink {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
  100% {
    opacity: 1;
  }
}

/* 2. è¿æ¥/æ–­å¼€æŒ‰é’® (Connect/Disconnect) çš„æ ·å¼ */
.connect-toggle-button .el-button {
  transition: all 0.5s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
  height: 28px;
  font-size: 14px;
}
/* é»˜è®¤çŠ¶æ€ (Success - Green) */
.connect-toggle-button .el-button--success.is-plain,
.connect-toggle-button .el-button--success.is-plain:focus {
  border-color: #67c23a;
  background-color: #ffffff;
  color: #67c23a;
}
/* æ‚¬åœ/èšç„¦çŠ¶æ€ (Success - Green): é¢œè‰²ç¿»è½¬ */
.connect-toggle-button .el-button--success.is-plain:hover {
  background-color: #67c23a;
  color: #ffffff;
}
/* é»˜è®¤çŠ¶æ€ (Danger - Red) */
.connect-toggle-button .el-button--danger.is-plain,
.connect-toggle-button .el-button--danger.is-plain:focus {
  border-color: #f56c6c;
  background-color: #ffffff;
  color: #f56c6c;
}
/* æ‚¬åœ/èšç„¦çŠ¶æ€ (Danger - Red): é¢œè‰²ç¿»è½¬ */
.connect-toggle-button .el-button--danger.is-plain:hover {
  background-color: #f56c6c;
  color: #ffffff;
}
.status-indicators {
  display: flex;
  align-items: center;
  gap: 20px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 5px;
}

.dot.connected {
  background-color: #ffffff;
}
.dot.disconnected {
  background-color: #ffffff;
}
.dot.error {
  background-color: #ffffff;
}
</style>


--- File: src/renderer/src/views/TopicMonitor.vue ---
<!-- src/renderer/src/components/TopicMonitor.vue -->
<template>
  <div class="topic-monitor-container">
    <div class="toolbar">
      <el-button type="primary" size="small" @click="addItem">
        <el-icon><Plus /></el-icon> æ–°å¢ç›‘æ§å¡ç‰‡
      </el-button>
      <el-button size="small" @click="saveLayout(true)">ä¿å­˜å¸ƒå±€</el-button>
      <el-button size="small" @click="resetLayout">é‡ç½®</el-button>
      <div class="hint">å¸ƒå±€è‡ªåŠ¨ä¿å­˜</div>
    </div>

    <div class="grid-canvas">
      <GridLayout
        v-if="layout.length > 0"
        v-model:layout="layout"
        :col-num="12"
        :row-height="30"
        :is-draggable="true"
        :is-resizable="true"
        :vertical-compact="true"
        :use-css-transforms="true"
      >
        <GridItem
          v-for="item in layout"
          :key="item.i"
          :x="item.x"
          :y="item.y"
          :w="item.w"
          :h="item.h"
          :i="item.i"
          class="grid-item-wrapper"
        >
          <!-- è¿™é‡Œçš„ config åŒ…å«äº† backendId å’Œ topicName -->
          <MonitorCard
            :config="item.config"
            @update:config="(val) => updateItemConfig(item, val)"
            @remove="removeItem(item.i)"
          />
        </GridItem>
      </GridLayout>
      <el-empty v-else description="ç‚¹å‡»ä¸Šæ–¹æ–°å¢æŒ‰é’®å¼€å§‹" />
    </div>
  </div>
</template>

<script setup>
  /* é€»è¾‘ä»£ç å·²çœç•¥ï¼Œä»…è¿›è¡ŒUIä¼˜åŒ– */
</script>

<style scoped>
.topic-monitor-container {
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  background-color: #111;
}
.toolbar {
  height: 40px;
  background-color: #1e1e1e;
  border-bottom: 1px solid #333;
  display: flex;
  align-items: center;
  padding: 0 15px;
  gap: 10px;
}
.hint {
  font-size: 12px;
  color: #666;
  margin-left: auto;
}
.grid-canvas {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 10px;
  background-image: radial-gradient(#333 1px, transparent 1px);
  background-size: 20px 20px;
}
.grid-item-wrapper {
  touch-action: none;
}
</style>


